<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BigInky Remote Control</title>
<style>
body{font-family:Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#1a1a1a;color:#e0e0e0;}
h1{color:#e0e0e0;border-bottom:2px solid #4CAF50;padding-bottom:10px;}
.section{background:#2a2a2a;padding:20px;margin:20px 0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.3);}
h2{color:#4CAF50;margin-top:0;}
label{display:block;margin:10px 0 5px 0;font-weight:bold;color:#e0e0e0;}
textarea{width:100%;min-height:100px;font-family:monospace;padding:10px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
select{width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
input[type="text"]{width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
button{background:#4CAF50;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin:5px;min-height:44px;touch-action:manipulation;-webkit-tap-highlight-color:rgba(76,175,80,0.3);}
button:hover{background:#45a049;}
button:disabled{background:#666;cursor:not-allowed;opacity:0.6;}
.status{color:#4CAF50;margin:10px 0;font-weight:bold;}
.error{color:#f44336;}
.info{color:#2196F3;margin:10px 0;padding:10px;background:#1a1a1a;border-radius:4px;border-left:3px solid #2196F3;}
.connection-status{display:inline-flex;align-items:center;gap:8px;padding:5px 10px;border-radius:4px;font-weight:bold;margin-left:10px;}
.connection-status::before{font-size:16px;}
.connected{background:#4CAF50;color:white;}
.connected::before{content:'‚úì';}
.disconnected{background:#f44336;color:white;}
.disconnected::before{content:'‚úó';}
.connecting{background:#ff9800;color:white;}
.connecting::before{content:'‚ü≥';animation:spin 1s linear infinite;}
.reconnecting{background:#ff9800;color:white;}
.reconnecting::before{content:'‚ü≥';animation:spin 1s linear infinite;}
.status-timestamp{font-size:11px;opacity:0.7;margin-left:10px;font-weight:normal;}
.flex-row{display:flex;flex-wrap:wrap;gap:15px;align-items:flex-end;margin-top:15px;}
.flex-item{flex:1;min-width:150px;}
button.flex-shrink{flex-shrink:0;margin-top:0;}
.tool-btn{background:#333;border:2px solid #555;color:#e0e0e0;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;}
.tool-btn:hover{background:#444;border-color:#666;}
.tool-btn.active{background:#4CAF50;border-color:#45a049;color:white;}
h2{cursor:pointer;user-select:none;position:relative;padding-right:20px;}
h2::after{content:'‚ñº';position:absolute;right:0;font-size:14px;opacity:0.7;transition:transform 0.2s;}
h2.collapsed::after{transform:rotate(-90deg);}
.section-content{overflow:hidden;transition:max-height 0.3s ease-out;}
.section-content.collapsed{display:none;}
canvas{border:2px solid #666;cursor:crosshair;background:#fff;touch-action:none;margin-top:10px;display:block;max-width:100%;height:auto;}
.busy-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:10000;flex-direction:column;}
.busy-overlay.active{display:flex;}
.busy-overlay .message{color:#fff;font-size:18px;margin-top:20px;text-align:center;}
.spinner{border:4px solid rgba(255,255,255,0.3);border-top:4px solid #4CAF50;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
/* Responsive design for mobile devices */
@media (max-width:768px){
body{padding:10px;}
.section{padding:15px;margin:15px 0;}
h1{font-size:24px;}
h2{font-size:20px;}
button{font-size:14px;padding:8px 16px;margin:3px;}
.flex-row{gap:10px;}
.flex-item{min-width:100%;}
/* Make tables horizontally scrollable on mobile */
.table-wrapper{overflow-x:auto;-webkit-overflow-scrolling:touch;}
table{min-width:600px;font-size:14px;}
table th,table td{padding:8px;font-size:13px;}
/* Responsive thumbnails - scale down on mobile */
.media-thumbnail{max-width:150px!important;max-height:112px!important;width:auto;height:auto;}
/* Stack form elements vertically on mobile */
.flex-row{flex-direction:column;}
.flex-item{width:100%;}
button.flex-shrink{width:100%;margin-top:10px;}
}
@media (max-width:480px){
body{padding:8px;}
.section{padding:12px;margin:12px 0;}
h1{font-size:20px;}
h2{font-size:18px;}
button{font-size:13px;padding:8px 12px;}
table{min-width:500px;font-size:12px;}
table th,table td{padding:6px;font-size:12px;}
.media-thumbnail{max-width:120px!important;max-height:90px!important;}
.busy-overlay .message{font-size:16px;padding:0 20px;}
}
</style>
<script src="https://cdn.jsdelivr.net/gh/eclipse/paho.mqtt.javascript@master/src/paho-mqtt.js" onerror="loadPahoFallback()"></script>
<!-- Load custom MQTT configuration if available, otherwise defaults will be used -->
<!-- Note: mqtt-config.js is optional - if it doesn't exist, defaults from config.js will be used -->
<script src="js/mqtt-config.js" onerror="console.log('No custom mqtt-config.js found, using defaults from config.js')"></script>
<!-- Load modules in dependency order -->
<script src="js/config.js"></script>
<script src="js/encryption.js"></script>
<script src="js/password.js"></script>
<script src="js/paho-loader.js"></script>
<script src="js/ui-utils.js"></script>
<script src="js/media.js"></script>
<script src="js/mqtt.js"></script>
<script src="js/commands.js"></script>
<script src="js/canvas.js"></script>
<script src="js/main.js"></script>
</head>
<body>
<div id="busyOverlay" class="busy-overlay">
<div class="spinner"></div>
<div class="message">Processing command... Please wait for device to respond.</div>
</div>
<h1>BigInky Remote Control</h1>
<div class="section">
<h2 onclick="toggleSection(this)">Authentication (Required)</h2>
<div class="section-content" id="section-auth">
<p style="color:#888;font-size:14px;margin-bottom:15px;"><strong>Password required.</strong> Enter the device password (set via local WiFi UI) to enable HMAC authentication. All functionality is disabled until a password is set.</p>
<div class="flex-row" style="align-items:center;gap:10px;">
<div style="flex:0 0 auto;white-space:nowrap;">
<label style="display:inline;margin:0;margin-right:8px;">Web UI Password:</label>
</div>
<div style="flex:1 1 auto;min-width:200px;">
<input type="password" id="webUIPassword" placeholder="Enter password (min 8 characters)..." onkeydown="if(event.key==='Enter'){event.preventDefault();savePassword();}" style="width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-family:monospace;height:38px;">
</div>
<div style="flex:0 0 auto;display:flex;gap:10px;">
<button onclick="savePassword()" style="height:38px;min-height:38px;padding:8px 16px;margin:0;">Save Password</button>
<button onclick="clearPassword()" style="height:38px;min-height:38px;padding:8px 16px;margin:0;background:#f44336;">Clear Password</button>
</div>
</div>
<div id="passwordStatus" style="margin-top:10px;"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Connection</h2>
<div class="section-content" id="section-connection">
<div style="text-align:center;">
<button onclick="connectMQTT()" id="connectBtn">Connect</button>
<button onclick="disconnectMQTT()" id="disconnectBtn" disabled>Disconnect</button>
<div style="margin-top:10px;">
<span id="connectionStatus" class="connection-status disconnected">Disconnected</span>
</div>
<div id="connectionStatusMsg" style="margin-top:10px;"></div>
</div>
<div style="margin-top:20px;border-top:1px solid #444;padding-top:20px;">
<h3 style="color:#4CAF50;margin-top:0;font-size:18px;">Device Status</h3>
<div id="deviceStatus" style="font-family:monospace;font-size:12px;color:#e0e0e0;">
<p>Not connected - status appears when connected</p>
</div>
</div>
<div style="margin-top:20px;border-top:1px solid #444;padding-top:20px;">
<h3 style="color:#4CAF50;margin-top:0;font-size:18px;">Display Preview</h3>
<p style="color:#888;margin-bottom:10px;">Latest display content (updated on refresh):</p>
<div id="thumbnailContainer" style="text-align:center;margin:20px 0;">
<canvas id="thumbnailCanvas" width="400" height="300" style="border:2px solid #666;background:#fff;max-width:100%;height:auto;display:none;margin:0 auto;"></canvas>
<p id="thumbnailStatus" style="color:#888;">No preview available yet</p>
</div>
</div>
</div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Media Mappings</h2>
<div class="section-content" id="section-media">
<p>Available media files from media.txt:</p>
<div id="mediaMappingsStatus" style="color:#888;margin-bottom:10px;">Not loaded - appears when connected</div>
<div class="table-wrapper">
<div id="mediaMappingsTable">
<!-- Table will be populated here -->
</div>
</div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Text Display</h2>
<div class="section-content" id="section-text">
<p>Enter text to display. Select text, background, and outline colours.</p>
<label>Text:</label>
<textarea id="textInput" placeholder="Enter text to display..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendTextDisplay();}"></textarea>
<div class="flex-row">
<div class="flex-item">
<label>Text Colour:</label>
<select id="textColor">
<option value="black" selected>Black</option>
<option value="yellow">Yellow</option>
<option value="red">Red</option>
<option value="blue">Blue</option>
<option value="green">Green</option>
<option value="multi">Multi (Random Colours)</option>
<option value="white">White</option>
</select>
</div>
<div class="flex-item">
<label>Background Colour:</label>
<select id="textBackgroundColor">
<option value="black">Black</option>
<option value="yellow">Yellow</option>
<option value="red">Red</option>
<option value="blue">Blue</option>
<option value="green">Green</option>
<option value="white" selected>White</option>
</select>
</div>
<div class="flex-item">
<label>Outline Colour:</label>
<select id="textOutlineColor">
<option value="black" selected>Black</option>
<option value="yellow">Yellow</option>
<option value="red">Red</option>
<option value="blue">Blue</option>
<option value="green">Green</option>
<option value="white">White</option>
</select>
</div>
<button onclick="sendTextDisplay()" class="flex-shrink" id="textDisplayBtn" disabled>Display Text</button>
</div>
<div id="textStatus"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Drawing Canvas</h2>
<div class="section-content" id="section-canvas">
<p>Draw on the canvas (1600x1200) - matches the display panel size. Images can be loaded and will be automatically posterized to match e-ink colors using Atkinson dithering.</p>
<div style="margin-bottom:15px;">
<label style="display:block;margin-bottom:8px;">Tool:</label>
<div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:15px;">
<button onclick="setTool('brush')" id="tool-brush" class="tool-btn active" title="Brush" style="width:44px;height:44px;padding:8px;font-size:20px;">üñåÔ∏è</button>
<button onclick="setTool('text')" id="tool-text" class="tool-btn" title="Text" style="width:44px;height:44px;padding:8px;font-size:20px;">T</button>
<button onclick="setTool('fill')" id="tool-fill" class="tool-btn" title="Fill" style="width:44px;height:44px;padding:8px;font-size:20px;">ü™£</button>
<button onclick="setTool('rectangle')" id="tool-rectangle" class="tool-btn" title="Rectangle" style="width:44px;height:44px;padding:8px;font-size:20px;">‚ñ≠</button>
<button onclick="setTool('circle')" id="tool-circle" class="tool-btn" title="Circle" style="width:44px;height:44px;padding:8px;font-size:20px;">‚óã</button>
<button onclick="setTool('line')" id="tool-line" class="tool-btn" title="Line" style="width:44px;height:44px;padding:8px;font-size:20px;">/</button>
<button onclick="setTool('eraser')" id="tool-eraser" class="tool-btn" title="Eraser" style="width:44px;height:44px;padding:8px;font-size:20px;">üßπ</button>
</div>
<input type="hidden" id="drawTool" value="brush">
</div>
<div class="flex-row" style="margin-bottom:15px;">
<div class="flex-item" style="min-width:120px;">
<label id="colorLabel">Colour:</label>
<select id="drawColor" style="width:100%;">
<option value="0" selected>Black</option>
<option value="2">Yellow</option>
<option value="3">Red</option>
<option value="5">Blue</option>
<option value="6">Green</option>
<option value="1">White</option>
</select>
</div>
<div class="flex-item" id="fillColorContainer" style="min-width:120px;display:none;">
<label>Fill Colour:</label>
<select id="fillColor" style="width:100%;">
<option value="1" selected>White</option>
<option value="0">Black</option>
<option value="2">Yellow</option>
<option value="3">Red</option>
<option value="5">Blue</option>
<option value="6">Green</option>
</select>
</div>
<div class="flex-item" id="outlineColorContainer" style="min-width:120px;display:none;">
<label>Outline Colour:</label>
<select id="outlineColor" style="width:100%;">
<option value="0" selected>Black</option>
<option value="2">Yellow</option>
<option value="3">Red</option>
<option value="5">Blue</option>
<option value="6">Green</option>
<option value="1">White</option>
</select>
</div>
<div class="flex-item" id="textToolOptions" style="min-width:150px;display:none;">
<label>Font Size:</label>
<select id="textFontSize" style="width:100%;">
<option value="12">12px</option>
<option value="16">16px</option>
<option value="20">20px</option>
<option value="24" selected>24px</option>
<option value="32">32px</option>
<option value="48">48px</option>
<option value="64">64px</option>
<option value="96">96px</option>
</select>
</div>
<div class="flex-item" id="textInputContainer" style="min-width:200px;display:none;">
<label>Text:</label>
<input type="text" id="canvasTextInput" placeholder="Enter text..." style="width:100%;padding:6px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;">
</div>
</div>
<div style="margin-bottom:10px;">
<button onclick="clearCanvas()">Clear Canvas</button>
<button onclick="undoCanvas()" id="undoBtn" disabled>Undo</button>
<button onclick="loadImageToCanvas()" id="loadImageBtn">Load Image</button>
<input type="file" id="imageFileInput" accept="image/*" style="display:none;" onchange="handleImageFileSelect(event)">
<button onclick="sendCanvasToDisplay()" id="canvasDisplayBtn" disabled>Display on Panel</button>
</div>
<canvas id="drawCanvas" width="1600" height="1200" style="max-width:100%;height:auto;"></canvas>
<div id="canvasStatus"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Other Commands</h2>
<div class="section-content" id="section-commands">
<button onclick="sendCommand('clear')" id="clearBtn" disabled>Clear Display</button>
<button onclick="sendCommand('next')" id="nextBtn" disabled>Next Media Item</button>
<div id="commandStatus"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Command Log</h2>
<div class="section-content" id="section-log">
<div id="commandLog" style="max-height:300px;overflow-y:auto;background:#1a1a1a;padding:10px;border:1px solid #444;border-radius:4px;font-family:monospace;font-size:12px;white-space:pre-wrap;word-wrap:break-word;color:#e0e0e0;"></div>
</div>
</div>
<script>
// All JavaScript code has been refactored into modules:
// - js/config.js: Configuration constants and state variables
// - js/encryption.js: Encryption/decryption and HMAC functions
// - js/password.js: Password management (load, save, clear)
// - js/paho-loader.js: Paho MQTT library loader
// - js/ui-utils.js: UI helper functions (status, busy state, logging, sections)
// - js/media.js: Media mappings and thumbnail display
// - js/mqtt.js: MQTT connection and message handling
// - js/commands.js: Command sending functions
// - js/canvas.js: Canvas drawing tools and history
// - js/main.js: Initialization code
</script>
</html>
