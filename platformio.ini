; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
boards_dir = boards

[env:pico_plus_2w]
platform = https://github.com/maxgerhardt/platform-raspberrypi.git
board = pimoroni_pico_plus_2w
framework = arduino
board_build.core = earlephilhower
board_build.psram_length = 0x800000

build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=40000000
	-DUSE_PSRAM=1
	-I$PROJECT_PACKAGES_DIR/framework-arduinopico/pico-sdk/src/rp2_common/hardware_powman/include
	-I$PROJECT_PACKAGES_DIR/framework-arduinopico/pico-sdk/src/rp2_common/pico_aon_timer/include
build_src_filter = 
	+<*>
	+<../../../.platformio/packages/framework-arduinopico/pico-sdk/src/rp2_common/hardware_powman/powman.c>
	+<../../../.platformio/packages/framework-arduinopico/pico-sdk/src/rp2_common/pico_aon_timer/aon_timer.c>
monitor_speed = 115200
lib_deps = 
	kikuchan98/pngle@^1.1.0
	SdFat@^2.2.3
build_type = release

; Pre-build script to regenerate color LUT if palette changes
; The LUT is stored in PROGMEM (flash) for zero runtime cost
; To regenerate manually: python scripts/generate_color_lut.py lib/EL133UF1/EL133UF1_ColorLUT.h
extra_scripts = pre:scripts/pre_build.py

; ============================================================================
; ESP32-P4-WIFI6 Configuration
; ============================================================================
; Uses pioarduino platform 55.03.34 which includes ESP32-P4 support
; with arduino-esp32 3.3.4 based on ESP-IDF 5.5
;
; Pin mapping must be adjusted for your specific ESP32-P4-WIFI6 board.
; PSRAM: ESP32-P4 supports up to 32MB PSRAM (Octal mode @ 200MHz)
; ============================================================================

[env:esp32p4_wifi6]
; pioarduino 55.03.34 has full ESP32-P4 support
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.34/platform-espressif32.zip
board = esp32p4_wifi6
framework = arduino

; Custom board definition in boards/ folder

; Build configuration
build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=40000000
	-DUSE_PSRAM=1
	-DBOARD_HAS_PSRAM
	; ESP32-P4-WIFI6 pin definitions - MATCHES PICO PHYSICAL LOCATIONS
	; Mapping: Pico GPxx -> ESP32-P4 GPIOyy (same physical pin)
	; SPI for display
	-DPIN_SPI_SCK=3      ; GP10 -> GPIO3 (pin 14)
	-DPIN_SPI_MOSI=2     ; GP11 -> GPIO2 (pin 15)
	-DPIN_CS0=23         ; GP26 -> GPIO23 (pin 31)
	-DPIN_CS1=48         ; GP16 -> GPIO48 (pin 21)
	-DPIN_DC=26          ; GP22 -> GPIO26 (pin 29)
	-DPIN_RESET=22       ; GP27 -> GPIO22 (pin 32)
	-DPIN_BUSY=47        ; GP17 -> GPIO47 (pin 22)
	; I2C for RTC (DS3231)
	-DPIN_RTC_SDA=31     ; GP2 -> GPIO31 (pin 4)
	-DPIN_RTC_SCL=30     ; GP3 -> GPIO30 (pin 5)
	-DPIN_RTC_INT=46     ; GP18 -> GPIO46 (pin 24)

build_src_filter = 
	+<*>

; Ignore RP2350-specific library
lib_ignore = 
	pico_sleep

monitor_speed = 115200

lib_deps = 
	kikuchan98/pngle@^1.1.0

build_type = release

; ============================================================================
; ESP32-P4 Minimal Test Build (Display Only)
; ============================================================================
; Use this for initial hardware testing - excludes WiFi/AI features

[env:esp32p4_minimal]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.34/platform-espressif32.zip
board = esp32p4_wifi6
framework = arduino

build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=80000000
	-DUSE_PSRAM=1
	-DBOARD_HAS_PSRAM
	; Use ARGB8888 mode for PPA acceleration (auto-detected on ESP32-P4)
	; To force L8 mode for testing, uncomment: -DEL133UF1_USE_ARGB8888=0
	; Disable features for minimal test build
	-DDISABLE_WIFI=1
	-DDISABLE_SDIO_TEST=1
	-DDISABLE_AI_IMAGE=1
	-DDISABLE_SLEEP=1
	; ESP32-P4-WIFI6 pin definitions - MATCHES PICO PHYSICAL LOCATIONS
	-DPIN_SPI_SCK=3      ; GP10 -> GPIO3 (pin 14)
	-DPIN_SPI_MOSI=2     ; GP11 -> GPIO2 (pin 15)
	-DPIN_CS0=23         ; GP26 -> GPIO23 (pin 31)
	-DPIN_CS1=48         ; GP16 -> GPIO48 (pin 21)
	-DPIN_DC=26          ; GP22 -> GPIO26 (pin 29)
	-DPIN_RESET=22       ; GP27 -> GPIO22 (pin 32)
	-DPIN_BUSY=47        ; GP17 -> GPIO47 (pin 22)

build_src_filter = 
	+<*>

lib_ignore = 
	pico_sleep

monitor_speed = 115200

lib_deps = 
	kikuchan98/pngle@^1.1.0

build_type = release

; ============================================================================
; ESP32-P4 WiFi Test Build
; ============================================================================
; Tests WiFi connectivity via ESP32-C6 companion chip (ESP-Hosted over SDIO)

[env:esp32p4_wifi_test]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.34/platform-espressif32.zip
board = esp32p4_wifi6
framework = arduino

build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=80000000
	-DUSE_PSRAM=1
	-DBOARD_HAS_PSRAM
	; Enable WiFi testing
	-DENABLE_WIFI_TEST=1
	; Disable display for faster iteration (comment to enable display)
	; -DDISABLE_DISPLAY=1
	; ESP32-P4-WIFI6 pin definitions
	-DPIN_SPI_SCK=3
	-DPIN_SPI_MOSI=2
	-DPIN_CS0=23
	-DPIN_CS1=48
	-DPIN_DC=26
	-DPIN_RESET=22
	-DPIN_BUSY=47
	; RTC pins
	-DPIN_RTC_SDA=31
	-DPIN_RTC_SCL=30
	-DPIN_RTC_INT=46

build_src_filter = 
	+<*>
	-<main_espidf.c>

lib_ignore = 
	pico_sleep

monitor_speed = 115200

lib_deps = 
	kikuchan98/pngle@^1.1.0

build_type = release

; ============================================================================
; ESP32-P4 ESP-IDF Build (with exFAT support)
; ============================================================================
; Pure ESP-IDF for full sdkconfig control including exFAT filesystem

[env:esp32p4_espidf]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.34/platform-espressif32.zip
board = esp32p4_wifi6
framework = espidf

build_flags = 
	-DPIN_SD_CLK=43
	-DPIN_SD_CMD=44
	-DPIN_SD_D0=39
	-DPIN_SD_D1=40
	-DPIN_SD_D2=41
	-DPIN_SD_D3=42
	-DPIN_SD_POWER=45

monitor_speed = 115200

build_type = release
