// Web Assets (HTML/CSS/JS)
// 
// Auto-generated by scripts/generate_web_header.py
// Source files in web/ directory
//
// This file contains the embedded HTML content for the management interface.
// Edit web/index.html and rebuild to update.

#ifndef WEB_ASSETS_H
#define WEB_ASSETS_H

// Embedded HTML content (from web/index.html)
const char* WEB_HTML_CONTENT = R"HTML(
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Device Management</title>
<style>
body{font-family:Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#1a1a1a;color:#e0e0e0;}
h1{color:#e0e0e0;border-bottom:2px solid #4CAF50;padding-bottom:10px;margin-top:60px;}
.header-controls{position:fixed;top:0;left:0;right:0;background:#2a2a2a;padding:10px 20px;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.3);display:flex;justify-content:space-between;align-items:center;}
.header-controls button{background:#f44336;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;font-weight:bold;width:40px;height:40px;display:flex;align-items:center;justify-content:center;}
.header-controls button.ota{background:#2196F3;width:auto;padding:8px 16px;}
.header-controls button:hover{opacity:0.9;}
.tabs{display:flex;gap:5px;margin:20px 0;border-bottom:2px solid #333;flex-wrap:wrap;}
.tab{background:#2a2a2a;color:#b0b0b0;border:none;padding:12px 24px;border-radius:8px 8px 0 0;cursor:pointer;font-size:16px;font-weight:bold;transition:all 0.2s;}
.tab:hover{background:#333;color:#e0e0e0;}
.tab.active{background:#1a1a1a;color:#4CAF50;border-bottom:3px solid #4CAF50;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.section{background:#2a2a2a;padding:20px;margin:20px 0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.3);}
h2{color:#4CAF50;margin-top:0;}
textarea{width:100%;min-height:200px;font-family:monospace;padding:10px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
input[type="number"]{width:100px;padding:8px;border:1px solid #444;border-radius:4px;background:#1a1a1a;color:#e0e0e0;}
select{width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
button{background:#4CAF50;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin:5px;}
button:hover{background:#45a049;}
button.delete{background:#f44336;padding:5px 10px;font-size:16px;width:30px;height:30px;min-width:30px;}
button.delete:hover{background:#d32f2f;}
.status{color:#4CAF50;margin:10px 0;font-weight:bold;}
.error{color:#f44336;}
label{display:block;margin:10px 0 5px 0;font-weight:bold;color:#e0e0e0;}
.form-group{margin:15px 0;}
td{padding:5px;}
table thead tr{background:#333 !important;}
table tbody tr{background:#2a2a2a;}
table tbody tr:hover{background:#333;}
input[type="checkbox"]{cursor:pointer;}
.quote-row{border-bottom:1px solid #444;padding:15px 0;margin-bottom:15px;}
.quote-row:last-child{border-bottom:none;}
.quote-text{margin-bottom:10px;}
.quote-author{color:#b0b0b0;font-style:italic;margin-top:5px;padding-top:10px;border-top:1px solid #444;}
.table-wrapper{overflow-x:auto;width:100%;}
canvas{max-width:100%;height:auto;}
@media (max-width:768px){
body{padding:10px;}
h1{margin-top:50px;font-size:20px;}
.section{padding:15px;}
.tab{padding:10px 15px;font-size:14px;}
button{font-size:14px;padding:8px 16px;}
.header-controls button.ota{font-size:12px;padding:6px 12px;}
table{font-size:14px;}
td{padding:8px 4px;}
}
</style>
</head>
<body>
<div class="header-controls">
<button onclick="closeServer()" title="Close Management Interface">✕</button>
<button class="ota" onclick="startOTA()">Start OTA Update Mode</button>
</div>
<h1>Device Configuration Management</h1>
<div class="tabs">
<button class="tab active" onclick="switchTab('draw')">Draw</button>
<button class="tab" onclick="switchTab('media')">Media</button>
<button class="tab" onclick="switchTab('config')">Config</button>
</div>
<div id="drawTab" class="tab-content active">
<div class="section"><h2>Text Display</h2>
<p>Enter text to display on the panel. Select a text colour (or "Multi" for random colours per word) and background colour.</p>
<label>Text:</label>
<textarea id="textInput" placeholder="Enter text to display..." style="width:100%;min-height:100px;padding:10px;border:1px solid #444;border-radius:4px;box-sizing:border-box;font-family:monospace;background:#1a1a1a;color:#e0e0e0;margin:10px 0;"></textarea>
<label style="margin-top:10px;">Text Colour:</label>
<select id="textColor" style="width:200px;margin-bottom:10px;">
<option value="black">Black</option>
<option value="yellow">Yellow</option>
<option value="red">Red</option>
<option value="blue">Blue</option>
<option value="green">Green</option>
<option value="multi">Multi (Random Colours)</option>
<option value="multi-fade">Multi-Fade (Gradient)</option>
<option value="white" selected>White</option>
</select>
<label style="margin-top:10px;">Background Colour:</label>
<select id="textBackgroundColor" style="width:200px;margin-bottom:10px;">
<option value="black">Black</option>
<option value="yellow">Yellow</option>
<option value="red">Red</option>
<option value="blue">Blue</option>
<option value="green">Green</option>
<option value="white" selected>White</option>
</select>
<button onclick="displayText()">Display Text on Panel</button>
<div id="textStatus"></div></div>
<div class="section"><h2>Drawing Canvas</h2>
<p>Draw on the canvas (800x600) and display it on the panel (1600x1200). The drawing will be scaled 2x and centered.</p>
<label>Colour:</label>
<select id="drawColor" style="width:150px;margin:10px 0;">
<option value="0" selected>Black</option>
<option value="2">Yellow</option>
<option value="3">Red</option>
<option value="5">Blue</option>
<option value="6">Green</option>
<option value="1">White</option>
</select>
<button onclick="clearCanvas()">Clear Canvas</button>
<button onclick="sendCanvasToDisplay()">Display on Panel</button>
<canvas id="drawCanvas" width="800" height="600" style="border:2px solid #666;cursor:crosshair;background:#fff;touch-action:none;margin-top:10px;display:block;max-width:100%;height:auto;"></canvas>
<div id="canvasStatus"></div></div>
</div>
<div id="mediaTab" class="tab-content">
<div class="section"><h2>Quotes Configuration (quotes.txt)</h2>
<p>Manage quotes and authors. Each quote must have an author (starting with ~). Quotes are separated by blank lines.</p>
<div id="quotesRows"></div>
<button onclick="addQuoteRow()">Add New Quote</button>
<button onclick="loadQuotes()">Load from Device</button>
<button onclick="saveQuotes()">Save to Device</button>
<div id="quotesStatus"></div></div>
<div class="section"><h2>Media Mappings (media.txt)</h2>
<p>Select image and audio file combinations. Leave audio empty for no audio. Check the "Next" box to set which item will be displayed next. Click "Show" to display the image and play audio on the panel.</p>
<div class="table-wrapper">
<table id="mediaTable" style="width:100%;border-collapse:collapse;margin:10px 0;min-width:600px;">
<thead><tr style="background:#333;"><th style="padding:10px;text-align:left;width:30%;">Image File</th><th style="padding:10px;text-align:left;width:30%;">Audio File</th><th style="padding:10px;text-align:center;width:10%;">Next</th><th style="padding:10px;text-align:center;width:15%;">Actions</th><th style="padding:10px;width:15%;"></th></tr></thead>
<tbody id="mediaRows"></tbody>
</table>
</div>
<button onclick="addMediaRow()">Add New Row</button>
<button onclick="loadMedia()">Load from Device</button>
<button onclick="saveMedia()">Save to Device</button>
<div id="mediaStatus"></div></div>
<div class="section"><h2>File Management</h2>
<p>Upload, download, and delete files on the SD card.</p>
<div style="margin:10px 0;"><input type="file" id="fileUpload" style="display:none;" onchange="handleFileSelect(event)"><button onclick="document.getElementById('fileUpload').click()">Upload File</button>
<button onclick="refreshFileList()">Refresh File List</button></div>
<div id="fileList" style="margin:10px 0;">Loading files...</div>
<div id="fileStatus"></div></div>
</div>
<div id="configTab" class="tab-content">
<div class="section"><h2>Device Settings</h2>
<div class="form-group">
<label>Volume (0-100%):</label>
<input type="number" id="volume" min="0" max="100" value="50">
</div>
<div class="form-group">
<label>Sleep Interval (minutes, must be factor of 60):</label>
<input type="number" id="sleepInterval" min="1" max="60" value="1">
</div>
<div class="form-group">
<label>Hour Schedule (check hours when device should wake):</label>
<div style="display:flex;flex-wrap:wrap;gap:10px;margin:10px 0;padding:10px;background:#1a1a1a;border-radius:4px;" id="hourSchedule"></div>
<div style="margin-top:10px;"><button onclick="selectAllHours()">Select All</button>
<button onclick="deselectAllHours()">Deselect All</button>
<button onclick="selectNightHours()">Select Night (6am-11pm)</button>
<button onclick="selectDayHours()">Select Day (11pm-6am)</button></div>
</div>
<button onclick="loadSettings()">Load from Device</button>
<button onclick="saveSettings()">Save to Device</button>
<div id="settingsStatus"></div></div>
<div class="section"><h2>System Log</h2>
<p>View the current system log file (read-only).</p>
<button onclick="loadLog()">Load Current Log</button>
<button onclick="loadLogArchiveList()">Load Previous Log</button>
<div id="logArchiveList" style="margin-top:10px;"></div>
<div id="logContent" style="margin:10px 0;max-height:600px;overflow-y:auto;background:#1a1a1a;padding:10px;border:1px solid #444;border-radius:4px;font-family:monospace;font-size:12px;white-space:pre-wrap;word-wrap:break-word;color:#e0e0e0;"></div>
<div id="logStatus"></div></div>
</div>
<div id="closeStatus" style="position:fixed;top:60px;right:20px;z-index:1001;"></div>
<div id="otaStatus" style="position:fixed;top:60px;right:20px;z-index:1001;"></div>
<script>
function switchTab(tabName){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));event.target.classList.add('active');document.getElementById(tabName+'Tab').classList.add('active');}
function createQuoteRow(quote='',author=''){const row=document.createElement('div');row.className='quote-row';row.dataset.index=document.getElementById('quotesRows').children.length;const quoteDiv=document.createElement('div');quoteDiv.className='quote-text';const quoteInput=document.createElement('textarea');quoteInput.className='quoteInput';quoteInput.value=quote;quoteInput.style.width='100%';quoteInput.style.minHeight='60px';quoteInput.style.padding='5px';quoteInput.style.border='1px solid #444';quoteInput.style.borderRadius='4px';quoteInput.style.boxSizing='border-box';quoteInput.style.fontFamily='monospace';quoteInput.style.fontSize='12px';quoteInput.style.background='#1a1a1a';quoteInput.style.color='#e0e0e0';quoteDiv.appendChild(quoteInput);const authorDiv=document.createElement('div');authorDiv.className='quote-author';const authorInput=document.createElement('input');authorInput.type='text';authorInput.className='authorInput';authorInput.value=author;authorInput.placeholder='~Author Name';authorInput.style.width='100%';authorInput.style.padding='5px';authorInput.style.border='1px solid #444';authorInput.style.borderRadius='4px';authorInput.style.boxSizing='border-box';authorInput.style.background='#1a1a1a';authorInput.style.color='#e0e0e0';authorDiv.appendChild(authorInput);const actionDiv=document.createElement('div');actionDiv.style.textAlign='right';actionDiv.style.marginTop='10px';const delBtn=document.createElement('button');delBtn.className='delete';delBtn.textContent='✕';delBtn.title='Delete';delBtn.onclick=function(){row.remove();updateQuoteRowIndices();};actionDiv.appendChild(delBtn);row.appendChild(quoteDiv);row.appendChild(authorDiv);row.appendChild(actionDiv);return row;}
function updateQuoteRowIndices(){const rows=document.querySelectorAll('#quotesRows .quote-row');rows.forEach((row,idx)=>{row.dataset.index=idx;});}
function addQuoteRow(){const container=document.getElementById('quotesRows');container.appendChild(createQuoteRow());}
function loadQuotes(){fetch('/api/quotes').then(r=>r.json()).then(quotes=>{const container=document.getElementById('quotesRows');container.innerHTML='';quotes.forEach(q=>{container.appendChild(createQuoteRow(q.quote||'',q.author||''));});updateQuoteRowIndices();if(container.children.length===0)addQuoteRow();showStatus('quotesStatus','Loaded successfully',false);}).catch(e=>{showStatus('quotesStatus','Error: '+e,true);});}
function saveQuotes(){const rows=document.querySelectorAll('#quotesRows .quote-row');let content='';let hasError=false;let errorMsg='';rows.forEach((row,idx)=>{const quote=row.querySelector('.quoteInput').value.trim();const author=row.querySelector('.authorInput').value.trim();if(quote.length>0&&author.length===0){hasError=true;errorMsg='Quote at row '+(idx+1)+' has no author';}if(quote.length>0||author.length>0){if(quote.length===0&&author.length>0){hasError=true;errorMsg='Row '+(idx+1)+' has author but no quote text';}if(!hasError){content+=quote;content+='\n~';content+=author;content+='\n\n';}}});if(hasError){showStatus('quotesStatus','Error: '+errorMsg,true);return;}const saveData={content:content.trim()};fetch('/api/quotes',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(saveData)}).then(r=>r.json()).then(d=>{showStatus('quotesStatus',d.success?'Saved successfully':'Error: '+d.error,d.success?false:true);if(d.success)loadQuotes();}).catch(e=>showStatus('quotesStatus','Error: '+e,true));}
let imageFiles=[];let audioFiles=[];let filesLoaded=0;
function checkAndLoadMedia(){if(filesLoaded>=2){loadMedia();}else if(filesLoaded===1){showStatus('mediaStatus','Warning: Only partial file list loaded',true);}}
function loadFileLists(){filesLoaded=0;fetch('/api/images').then(r=>r.json()).then(f=>{imageFiles=f;filesLoaded++;checkAndLoadMedia();}).catch(e=>{showStatus('mediaStatus','Error loading images: '+e,true);filesLoaded++;checkAndLoadMedia();});fetch('/api/audio').then(r=>r.json()).then(f=>{audioFiles=f;filesLoaded++;checkAndLoadMedia();}).catch(e=>{showStatus('mediaStatus','Error loading audio: '+e,true);filesLoaded++;checkAndLoadMedia();});}
let showInProgress=false;function createMediaRow(image='',audio='',isNext=false){const row=document.createElement('tr');row.dataset.index=document.getElementById('mediaRows').children.length;const imgCell=document.createElement('td');const imgSelect=document.createElement('select');imgSelect.className='imageSelect';imgSelect.style.background='#1a1a1a';imgSelect.style.color='#e0e0e0';imgSelect.style.border='1px solid #444';imgSelect.innerHTML='<option value="">-- Select Image --</option>';imageFiles.forEach(f=>{const opt=document.createElement('option');opt.value=f;opt.text=f;opt.selected=(f===image);imgSelect.appendChild(opt);});imgCell.appendChild(imgSelect);const audCell=document.createElement('td');const audSelect=document.createElement('select');audSelect.className='audioSelect';audSelect.style.background='#1a1a1a';audSelect.style.color='#e0e0e0';audSelect.style.border='1px solid #444';audSelect.innerHTML='<option value="">(none)</option>';audioFiles.forEach(f=>{const opt=document.createElement('option');opt.value=f;opt.text=f;opt.selected=(f===audio);audSelect.appendChild(opt);});audCell.appendChild(audSelect);const nextCell=document.createElement('td');nextCell.style.textAlign='center';const nextCheck=document.createElement('input');nextCheck.type='checkbox';nextCheck.className='nextCheckbox';nextCheck.checked=isNext;nextCheck.onchange=function(){document.querySelectorAll('.nextCheckbox').forEach(cb=>{if(cb!==nextCheck)cb.checked=false;});};nextCell.appendChild(nextCheck);const actionCell=document.createElement('td');actionCell.style.textAlign='center';const showBtn=document.createElement('button');showBtn.className='showBtn';showBtn.textContent='Show';showBtn.style.margin='2px';showBtn.style.padding='4px 8px';showBtn.style.fontSize='12px';showBtn.disabled=showInProgress;showBtn.onclick=function(){if(showInProgress){alert('Another show operation is in progress. Please wait.');return;}const idx=parseInt(row.dataset.index);showMediaItem(idx);};actionCell.appendChild(showBtn);const delCell=document.createElement('td');const delBtn=document.createElement('button');delBtn.className='delete';delBtn.textContent='✕';delBtn.title='Delete';delBtn.onclick=function(){row.remove();updateRowIndices();};delCell.appendChild(delBtn);row.appendChild(imgCell);row.appendChild(audCell);row.appendChild(nextCell);row.appendChild(actionCell);row.appendChild(delCell);return row;}
function showMediaItem(index){if(showInProgress){return;}showInProgress=true;document.querySelectorAll('.showBtn').forEach(btn=>btn.disabled=true);showStatus('mediaStatus','Displaying image and playing audio (this will take 20-30 seconds)...',false);fetch('/api/media/show?index='+index,{method:'POST'}).then(r=>r.json()).then(d=>{showInProgress=false;document.querySelectorAll('.showBtn').forEach(btn=>btn.disabled=false);if(d.success){showStatus('mediaStatus','Display updated successfully. Next item: '+(d.nextIndex+1),false);loadMedia();}else{showStatus('mediaStatus','Error: '+d.error,true);}}).catch(e=>{showInProgress=false;document.querySelectorAll('.showBtn').forEach(btn=>btn.disabled=false);showStatus('mediaStatus','Error: '+e,true);});}
function updateRowIndices(){const rows=document.querySelectorAll('#mediaRows tr');rows.forEach((row,idx)=>{row.dataset.index=idx;});}
function addMediaRow(){const tbody=document.getElementById('mediaRows');tbody.appendChild(createMediaRow());}
function loadMedia(){Promise.all([fetch('/api/media').then(r=>r.text()),fetch('/api/media/index').then(r=>r.json())]).then(([content,indexData])=>{const tbody=document.getElementById('mediaRows');tbody.innerHTML='';const lastDisplayedIndex=indexData.index||0;const lines=content.split('\n');const mediaCount=lines.filter(l=>{l=l.trim();return l.length>0&&!l.startsWith('#');}).length;const nextIndex=(lastDisplayedIndex+1)%mediaCount;let lineIdx=0;lines.forEach((line,idx)=>{line=line.trim();if(line.length===0||line.startsWith('#'))return;const comma=line.indexOf(',');const isNext=(lineIdx===nextIndex);if(comma>0){const img=line.substring(0,comma).trim();const aud=line.substring(comma+1).trim();tbody.appendChild(createMediaRow(img,aud,isNext));}else if(line.length>0){tbody.appendChild(createMediaRow(line,'',isNext));}lineIdx++;});updateRowIndices();if(tbody.children.length===0)addMediaRow();showStatus('mediaStatus','Loaded successfully',false);}).catch(e=>{showStatus('mediaStatus','Error: '+e,true);});}
function saveMedia(){const rows=document.querySelectorAll('#mediaRows tr');let content='';let nextIndex=-1;rows.forEach((row,idx)=>{const img=row.querySelector('.imageSelect').value;const aud=row.querySelector('.audioSelect').value;const isNext=row.querySelector('.nextCheckbox').checked;if(isNext)nextIndex=idx;if(img.length>0){content+=img;if(aud.length>0)content+=','+aud;content+='\n';}});const saveData={content:content,nextIndex:nextIndex>=0?nextIndex:null};fetch('/api/media',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(saveData)}).then(r=>r.json()).then(d=>{showStatus('mediaStatus',d.success?'Saved successfully':'Error: '+d.error,d.success?false:true);if(d.success)loadMedia();}).catch(e=>showStatus('mediaStatus','Error: '+e,true));}
function loadSettings(){fetch('/api/settings').then(r=>r.json()).then(d=>{document.getElementById('volume').value=d.volume;document.getElementById('sleepInterval').value=d.sleepInterval;if(d.hourSchedule){const schedule=d.hourSchedule;document.querySelectorAll('.hourCheckbox').forEach(cb=>{const hour=parseInt(cb.dataset.hour);cb.checked=schedule[hour]==='1'||schedule[hour]===true;});}showStatus('settingsStatus','Loaded successfully',false);}).catch(e=>showStatus('settingsStatus','Error: '+e,true));}
function saveSettings(){const hourSchedule=[];document.querySelectorAll('.hourCheckbox').forEach(cb=>{hourSchedule.push(cb.checked?'1':'0');});const json=JSON.stringify({volume:parseInt(document.getElementById('volume').value),sleepInterval:parseInt(document.getElementById('sleepInterval').value),hourSchedule:hourSchedule.join('')});fetch('/api/settings',{method:'POST',headers:{'Content-Type':'application/json'},body:json}).then(r=>r.json()).then(d=>{showStatus('settingsStatus',d.success?'Saved successfully':'Error: '+d.error,d.success?false:true);if(d.success)loadSettings();}).catch(e=>showStatus('settingsStatus','Error: '+e,true));}
function selectAllHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>cb.checked=true);}
function deselectAllHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>cb.checked=false);}
function selectNightHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>{const hour=parseInt(cb.dataset.hour);cb.checked=(hour>=6&&hour<23);});}
function selectDayHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>{const hour=parseInt(cb.dataset.hour);cb.checked=(hour>=23||hour<6);});}
let fileListData=[];let fileListSortCol='name';let fileListSortDir=1;
function formatDate(timestamp){if(!timestamp||timestamp===0)return'N/A';const d=new Date(timestamp);return d.toLocaleString();}
function sortFileList(col){if(fileListSortCol===col){fileListSortDir*=-1;}else{fileListSortCol=col;fileListSortDir=1;}renderFileList();}
function escapeHtml(str){const div=document.createElement('div');div.textContent=str;return div.innerHTML;}
function escapeJs(str){return str.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,'\\n').replace(/\r/g,'\\r');}
function renderFileList(){const list=document.getElementById('fileList');if(fileListData.length===0){list.innerHTML='<p>No files found on SD card.</p>';return;}const sorted=fileListData.slice().sort((a,b)=>{let valA,valB;if(fileListSortCol==='name'){valA=a.name.toLowerCase();valB=b.name.toLowerCase();}else if(fileListSortCol==='size'){valA=a.size;valB=b.size;}else if(fileListSortCol==='modified'){valA=a.modified||0;valB=b.modified||0;}return valA<valB?-1*fileListSortDir:valA>valB?1*fileListSortDir:0;});let html='<table style="width:100%;border-collapse:collapse;"><thead><tr style="background:#333;">';html+=`<th style="padding:8px;text-align:left;cursor:pointer;" onclick="sortFileList('name')">Filename ${fileListSortCol==='name'?(fileListSortDir>0?'▲':'▼'):''}</th>`;html+=`<th style="padding:8px;text-align:right;cursor:pointer;" onclick="sortFileList('size')">Size ${fileListSortCol==='size'?(fileListSortDir>0?'▲':'▼'):''}</th>`;html+=`<th style="padding:8px;text-align:left;cursor:pointer;" onclick="sortFileList('modified')">Last Modified ${fileListSortCol==='modified'?(fileListSortDir>0?'▲':'▼'):''}</th>`;html+='<th style="padding:8px;text-align:center;width:140px;">Actions</th></tr></thead><tbody>';sorted.forEach(f=>{const size=f.size>=1024*1024?(f.size/(1024*1024)).toFixed(2)+' MB':f.size>=1024?(f.size/1024).toFixed(2)+' KB':f.size+' B';const modified=formatDate(f.modified);const nameEscaped=escapeJs(f.name);const nameHtml=escapeHtml(f.name);html+=`<tr><td style="padding:8px;">${nameHtml}</td><td style="padding:8px;text-align:right;">${size}</td><td style="padding:8px;">${modified}</td><td style="padding:8px;text-align:center;"><button onclick="downloadFile('${nameEscaped}')" style="margin:2px;padding:4px 8px;font-size:12px;">Download</button><button onclick="deleteFile('${nameEscaped}')" class="delete" style="margin:2px;padding:4px 8px;font-size:12px;">Delete</button></td></tr>`;});html+='</tbody></table></div>';list.innerHTML=html;}
function refreshFileList(){fetch('/api/files').then(r=>r.json()).then(files=>{fileListData=files;fileListSortCol='name';fileListSortDir=1;renderFileList();showStatus('fileStatus','File list refreshed',false);}).catch(e=>{showStatus('fileStatus','Error loading files: '+e,true);});}
function downloadFile(filename){window.location.href='/api/files/'+encodeURIComponent(filename);showStatus('fileStatus','Downloading '+filename,false);}
function deleteFile(filename){if(confirm('Delete '+filename+'?')){fetch('/api/files/'+encodeURIComponent(filename),{method:'DELETE'}).then(r=>r.json()).then(d=>{showStatus('fileStatus',d.success?'Deleted successfully':'Error: '+d.error,d.success?false:true);if(d.success)refreshFileList();}).catch(e=>showStatus('fileStatus','Error: '+e,true));}}
function uploadFileChunked(file,base64Data,chunkSize){const totalChunks=Math.ceil(base64Data.length/chunkSize);let uploadedChunks=0;function uploadChunk(index){const start=index*chunkSize;const end=Math.min(start+chunkSize,base64Data.length);const chunk=base64Data.substring(start,end);const payload=JSON.stringify({filename:file.name,chunkIndex:index,totalChunks:totalChunks,chunkData:chunk});fetch('/api/files/upload/chunk',{method:'POST',headers:{'Content-Type':'application/json'},body:payload}).then(r=>r.json()).then(d=>{if(d.success){uploadedChunks++;const progress=Math.round((uploadedChunks/totalChunks)*100);showStatus('fileStatus','Uploading '+file.name+'... '+progress+'%',false);if(uploadedChunks<totalChunks){uploadChunk(uploadedChunks);}else{showStatus('fileStatus','Uploaded successfully ('+d.size+' bytes)',false);refreshFileList();document.getElementById('fileUpload').value='';}}else{showStatus('fileStatus','Error: '+d.error,true);}}).catch(e=>{showStatus('fileStatus','Error uploading chunk: '+e,true);});}uploadChunk(0);}
function handleFileSelect(event){const file=event.target.files[0];if(!file)return;showStatus('fileStatus','Reading '+file.name+'...',false);const reader=new FileReader();reader.onload=function(e){const base64Data=e.target.result;const base64Content=base64Data.substring(base64Data.indexOf(',')+1);const decodedSizeKB=(base64Content.length*3/4/1024).toFixed(1);const base64SizeKB=(base64Content.length/1024).toFixed(1);const chunkSize=300*1024;const maxSingleRequestSize=400*1024;if(base64Content.length>maxSingleRequestSize){showStatus('fileStatus','File is large ('+decodedSizeKB+' KB decoded, '+base64SizeKB+' KB base64), using chunked upload...',false);uploadFileChunked(file,base64Content,chunkSize);}else{const payload=JSON.stringify({filename:file.name,data:base64Content});showStatus('fileStatus','Uploading '+file.name+'...',false);fetch('/api/files/upload',{method:'POST',headers:{'Content-Type':'application/json'},body:payload}).then(r=>r.json()).then(d=>{showStatus('fileStatus',d.success?'Uploaded successfully ('+d.size+' bytes)':'Error: '+d.error,d.success?false:true);if(d.success){refreshFileList();document.getElementById('fileUpload').value='';}}).catch(e=>{showStatus('fileStatus','Error: '+e,true);});}};reader.onerror=function(e){showStatus('fileStatus','Error reading file',true);};reader.readAsDataURL(file);}
function loadLog(){logFlush();fetch('/api/log').then(r=>r.text()).then(content=>{document.getElementById('logContent').textContent=content;showStatus('logStatus','Log loaded',false);}).catch(e=>{showStatus('logStatus','Error loading log: '+e,true);document.getElementById('logContent').textContent='Error: '+e;});}
function loadLogArchiveList(){fetch('/api/log/list').then(r=>r.json()).then(files=>{const listDiv=document.getElementById('logArchiveList');if(files.length===0){listDiv.innerHTML='<p style="color:#999;">No archived log files found. Log rotation has not occurred yet.</p>';return;}let html='<p><strong>Recent archived logs (most recent first):</strong></p><div style="display:flex;flex-direction:column;gap:5px;">';files.forEach((file,idx)=>{const filenameEscaped=file.filename.replace(/"/g,'&quot;').replace(/'/g,'&#39;');html+='<button onclick="loadLogArchive(\''+filenameEscaped+'\')" style="text-align:left;padding:8px;">'+file.filename+' ('+formatFileSize(file.size)+')</button>';});html+='</div>';listDiv.innerHTML=html;showStatus('logStatus','Found '+files.length+' archived log file(s)',false);}).catch(e=>{showStatus('logStatus','Error loading archive list: '+e,true);document.getElementById('logArchiveList').innerHTML='<p style="color:red;">Error: '+e+'</p>';});}
function loadLogArchive(filename){const url=filename?'/api/log/archive?file='+encodeURIComponent(filename):'/api/log/archive';fetch(url).then(r=>{if(!r.ok){return r.text().then(text=>{throw new Error(text);});}return r.text();}).then(content=>{document.getElementById('logContent').textContent=content;showStatus('logStatus',filename?'Archive log loaded: '+filename:'Archive log loaded',false);}).catch(e=>{showStatus('logStatus','Error loading archive: '+e,true);document.getElementById('logContent').textContent='Error: '+e;});}
function formatFileSize(bytes){if(bytes<1024)return bytes+' B';if(bytes<1024*1024)return (bytes/1024).toFixed(1)+' KB';return (bytes/(1024*1024)).toFixed(1)+' MB';}
function logFlush(){fetch('/api/log/flush',{method:'POST'});}
function closeServer(){if(confirm('Close management interface and return to normal operation?')){fetch('/api/close',{method:'POST'}).then(r=>r.json()).then(d=>{showStatus('closeStatus','Management interface closed. You can close this page.',false);setTimeout(()=>{window.location.href='about:blank';},2000);}).catch(e=>showStatus('closeStatus','Error: '+e,true));}}
function startOTA(){if(confirm('Start OTA update mode? The device will listen for firmware updates for 10 minutes. You can then upload firmware to /update endpoint.')){showStatus('otaStatus','Starting OTA server...',false);fetch('/api/ota/start',{method:'POST'}).then(r=>r.json()).then(d=>{if(d.success){showStatus('otaStatus','OTA server started! Upload firmware to: '+d.url,false);}else{showStatus('otaStatus','Error: '+d.error,true);}}).catch(e=>{showStatus('otaStatus','Error: '+e,true);});}}
function displayText(){const text=document.getElementById('textInput').value.trim();if(text.length===0){showStatus('textStatus','Please enter some text',true);return;}const color=document.getElementById('textColor').value;const bgColor=document.getElementById('textBackgroundColor').value;showStatus('textStatus','Displaying text...',false);fetch('/api/text/display',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:text,color:color,backgroundColour:bgColor})}).then(r=>r.json()).then(d=>{showStatus('textStatus',d.success?'Text displayed successfully!':'Error: '+d.error,d.success?false:true);}).catch(e=>{showStatus('textStatus','Error: '+e,true);});}
function showStatus(id,msg,isError){const el=document.getElementById(id);el.textContent=msg;el.className=isError?'error status':'status';}
let canvas=document.getElementById('drawCanvas');let ctx=canvas.getContext('2d');let isDrawing=false;let lastX=0;let lastY=0;
const colorMap={0:'#000000',1:'#FFFFFF',2:'#FFFF00',3:'#FF0000',5:'#0000FF',6:'#00FF00'};
function getDrawColor(){const val=parseInt(document.getElementById('drawColor').value);return colorMap[val]||'#000000';}
function startDraw(e){isDrawing=true;const rect=canvas.getBoundingClientRect();lastX=e.clientX?e.clientX-rect.left:e.touches[0].clientX-rect.left;lastY=e.clientY?e.clientY-rect.top:e.touches[0].clientY-rect.top;}
function draw(e){if(!isDrawing)return;e.preventDefault();const rect=canvas.getBoundingClientRect();const x=e.clientX?e.clientX-rect.left:e.touches[0].clientX-rect.left;const y=e.clientY?e.clientY-rect.top:e.touches[0].clientY-rect.top;ctx.strokeStyle=getDrawColor();ctx.lineWidth=2;ctx.lineCap='round';ctx.beginPath();ctx.moveTo(lastX,lastY);ctx.lineTo(x,y);ctx.stroke();lastX=x;lastY=y;}
function stopDraw(){isDrawing=false;}
function clearCanvas(){ctx.fillStyle='#FFFFFF';ctx.fillRect(0,0,800,600);showStatus('canvasStatus','Canvas cleared',false);}
canvas.addEventListener('mousedown',startDraw);canvas.addEventListener('mousemove',draw);canvas.addEventListener('mouseup',stopDraw);canvas.addEventListener('mouseleave',stopDraw);
canvas.addEventListener('touchstart',(e)=>{e.preventDefault();startDraw(e);});canvas.addEventListener('touchmove',(e)=>{e.preventDefault();draw(e);});canvas.addEventListener('touchend',(e)=>{e.preventDefault();stopDraw();});
function quantizeToEinkColors(imageData){const data=imageData.data;const einkColors=[[0,0,0],[255,255,255],[255,255,0],[255,0,0],[0,0,255],[0,255,0]];function findClosestColor(r,g,b){let minDist=Infinity;let closestIdx=0;for(let i=0;i<einkColors.length;i++){const ec=einkColors[i];const dist=Math.pow(r-ec[0],2)+Math.pow(g-ec[1],2)+Math.pow(b-ec[2],2);if(dist<minDist){minDist=dist;closestIdx=i;}}return closestIdx;}for(let i=0;i<data.length;i+=4){const r=data[i];const g=data[i+1];const b=data[i+2];const idx=findClosestColor(r,g,b);const color=einkColors[idx];data[i]=color[0];data[i+1]=color[1];data[i+2]=color[2];}return imageData;}
function sendCanvasToDisplay(){showStatus('canvasStatus','Preparing pixel data...',false);const ctx=canvas.getContext('2d');const imageData=ctx.getImageData(0,0,800,600);const data=imageData.data;const einkColors=[[0,0,0],[255,255,255],[255,255,0],[255,0,0],[0,0,255],[0,255,0]];const einkColorValues=[0,1,2,3,5,6];function findClosestColorIdx(r,g,b){let minDist=Infinity;let closestIdx=0;for(let i=0;i<einkColors.length;i++){const ec=einkColors[i];const dist=Math.pow(r-ec[0],2)+Math.pow(g-ec[1],2)+Math.pow(b-ec[2],2);if(dist<minDist){minDist=dist;closestIdx=i;}}return closestIdx;}const pixelData=[];for(let i=0;i<data.length;i+=4){const r=data[i];const g=data[i+1];const b=data[i+2];const arrayIdx=findClosestColorIdx(r,g,b);const einkColorValue=einkColorValues[arrayIdx];pixelData.push(einkColorValue);}const pixelBytes=new Uint8Array(pixelData);const rawSizeKB=(pixelBytes.length/1024).toFixed(1);showStatus('canvasStatus','Compressing pixel data ('+rawSizeKB+' KB raw)...',false);if(typeof CompressionStream!=='undefined'){const stream=new CompressionStream('deflate');const writer=stream.writable.getWriter();const reader=stream.readable.getReader();writer.write(pixelBytes).then(()=>writer.close());const compressedChunks=[];function pump(){return reader.read().then(({done,value})=>{if(done)return;compressedChunks.push(value);return pump();});}pump().then(()=>{const compressedLength=compressedChunks.reduce((sum,chunk)=>sum+chunk.length,0);const compressed=new Uint8Array(compressedLength);let offset=0;compressedChunks.forEach(chunk=>{compressed.set(chunk,offset);offset+=chunk.length;});const base64Data=btoa(String.fromCharCode.apply(null,compressed));const compressedSizeKB=(compressed.length/1024).toFixed(1);const base64SizeKB=(base64Data.length/1024).toFixed(1);const ratio=((compressed.length/pixelBytes.length)*100).toFixed(1);const savedKB=((pixelBytes.length-compressed.length)/1024).toFixed(1);const jsonSize=JSON.stringify({pixelData:base64Data,width:800,height:600,compressed:true}).length;const jsonSizeKB=(jsonSize/1024).toFixed(1);showStatus('canvasStatus','Compressed: '+compressedSizeKB+' KB binary ('+base64SizeKB+' KB base64), '+ratio+'% of '+rawSizeKB+' KB raw. Saved: '+savedKB+' KB. Total JSON: '+jsonSizeKB+' KB',false);fetch('/api/canvas/display',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pixelData:base64Data,width:800,height:600,compressed:true})}).then(r=>r.json()).then(d=>{showStatus('canvasStatus',d.success?'Drawing displayed successfully!':'Error: '+d.error,d.success?false:true);}).catch(e=>{showStatus('canvasStatus','Error: '+e,true);});}).catch(e=>{showStatus('canvasStatus','Compression error: '+e+', sending uncompressed',true);const base64Data=btoa(String.fromCharCode.apply(null,pixelBytes));fetch('/api/canvas/display',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pixelData:base64Data,width:800,height:600,compressed:false})}).then(r=>r.json()).then(d=>{showStatus('canvasStatus',d.success?'Drawing displayed successfully!':'Error: '+d.error,d.success?false:true);}).catch(e=>{showStatus('canvasStatus','Error: '+e,true);});});}else{const base64Data=btoa(String.fromCharCode.apply(null,pixelBytes));const base64SizeKB=(base64Data.length/1024).toFixed(1);const jsonSize=JSON.stringify({pixelData:base64Data,width:800,height:600,compressed:false}).length;const jsonSizeKB=(jsonSize/1024).toFixed(1);showStatus('canvasStatus','Uncompressed: '+rawSizeKB+' KB raw ('+base64SizeKB+' KB base64). Total JSON: '+jsonSizeKB+' KB (compression not available)',false);fetch('/api/canvas/display',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pixelData:base64Data,width:800,height:600,compressed:false})}).then(r=>r.json()).then(d=>{showStatus('canvasStatus',d.success?'Drawing displayed successfully!':'Error: '+d.error,d.success?false:true);}).catch(e=>{showStatus('canvasStatus','Error: '+e,true);});}}
let lastActivityPing=0;const ACTIVITY_PING_INTERVAL=30000;function pingActivity(){const now=Date.now();if(now-lastActivityPing<ACTIVITY_PING_INTERVAL)return;lastActivityPing=now;fetch('/api/activity',{method:'POST'}).catch(()=>{});}
document.addEventListener('click',pingActivity);document.addEventListener('keydown',pingActivity);document.addEventListener('mousemove',()=>{if(Date.now()-lastActivityPing>5000)pingActivity();});document.addEventListener('touchstart',pingActivity);document.addEventListener('scroll',()=>{if(Date.now()-lastActivityPing>5000)pingActivity();});
window.onload=function(){loadQuotes();loadFileLists();loadSettings();refreshFileList();clearCanvas();pingActivity();for(let i=0;i<24;i++){const cb=document.createElement('input');cb.type='checkbox';cb.className='hourCheckbox';cb.dataset.hour=i;const label=document.createElement('label');label.appendChild(cb);label.appendChild(document.createTextNode(' '+String(i).padStart(2,'0')+':00'));label.style.marginRight='10px';label.style.color='#e0e0e0';document.getElementById('hourSchedule').appendChild(label);}};
</script>
</body>
</html>

)HTML";

// Length of HTML content (for reference, not needed for null-terminated string)
const size_t WEB_HTML_CONTENT_LEN = 37587;

#endif // WEB_ASSETS_H
