// Web Assets (HTML/CSS/JS)
// 
// Auto-generated by scripts/generate_web_header.py
// Source files in web/ directory
//
// This file contains the embedded HTML content for the management interface.
// Edit web/index.html and rebuild to update.

#ifndef WEB_ASSETS_H
#define WEB_ASSETS_H

// Embedded HTML content (from web/index.html)
const char* WEB_HTML_CONTENT = R"HTML(
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Device Management</title>
<style>
body{font-family:Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#1a1a1a;color:#e0e0e0;}
h1{color:#e0e0e0;border-bottom:2px solid #4CAF50;padding-bottom:10px;margin-top:60px;}
.header-controls{position:fixed;top:0;left:0;right:0;background:#2a2a2a;padding:10px 20px;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.3);display:flex;justify-content:space-between;align-items:center;}
.header-controls button{background:#f44336;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;font-weight:bold;width:40px;height:40px;display:flex;align-items:center;justify-content:center;}
.header-controls button.ota{background:#2196F3;width:auto;padding:8px 16px;}
.header-controls button:hover{opacity:0.9;}
.tabs{display:flex;gap:5px;margin:20px 0;border-bottom:2px solid #333;flex-wrap:wrap;}
.tab{background:#2a2a2a;color:#b0b0b0;border:none;padding:12px 24px;border-radius:8px 8px 0 0;cursor:pointer;font-size:16px;font-weight:bold;transition:all 0.2s;}
.tab:hover{background:#333;color:#e0e0e0;}
.tab.active{background:#1a1a1a;color:#4CAF50;border-bottom:3px solid #4CAF50;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.section{background:#2a2a2a;padding:20px;margin:20px 0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.3);}
h2{color:#4CAF50;margin-top:0;}
textarea{width:100%;min-height:200px;font-family:monospace;padding:10px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
input[type="number"]{width:100px;padding:8px;border:1px solid #444;border-radius:4px;background:#1a1a1a;color:#e0e0e0;}
select{width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
button{background:#4CAF50;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin:5px;}
button:hover{background:#45a049;}
button.delete{background:#f44336;padding:5px 10px;font-size:16px;width:30px;height:30px;min-width:30px;}
button.delete:hover{background:#d32f2f;}
.status{color:#4CAF50;margin:10px 0;font-weight:bold;}
.error{color:#f44336;}
label{display:block;margin:10px 0 5px 0;font-weight:bold;color:#e0e0e0;}
.form-group{margin:15px 0;}
td{padding:5px;}
table thead tr{background:#333 !important;}
table tbody tr{background:#2a2a2a;}
table tbody tr:hover{background:#333;}
input[type="checkbox"]{cursor:pointer;}
.table-wrapper{overflow-x:auto;width:100%;}
@media (max-width:768px){
body{padding:10px;}
h1{margin-top:50px;font-size:20px;}
.section{padding:15px;}
.tab{padding:10px 15px;font-size:14px;}
button{font-size:14px;padding:8px 16px;}
.header-controls button.ota{font-size:12px;padding:6px 12px;}
table{font-size:14px;}
td{padding:8px 4px;}
}
</style>
</head>
<body>
<div class="header-controls">
<button onclick="closeServer()" title="Close Management Interface">‚úï</button>
<label style="display:flex;align-items:center;gap:8px;color:#e0e0e0;cursor:pointer;margin:0 10px;"><input type="checkbox" id="timeoutDisabledCheckbox" onchange="toggleTimeoutDisabled()" style="cursor:pointer;width:18px;height:18px;">Disable timeout</label>
<button class="ota" onclick="startOTA()">Start OTA Update Mode</button>
<button class="ota" onclick="triggerHappyWeather()" style="background:#FF9800;">Happy Place Weather</button>
</div>
<h1>Device Configuration Management</h1>
<div class="tabs">
<button class="tab active" onclick="switchTab('media')">Media</button>
<button class="tab" onclick="switchTab('config')">Config</button>
</div>
<div id="mediaTab" class="tab-content active">
<div class="section"><h2>Quotes Configuration (quotes.txt)</h2>
<p>Manage quotes and authors. Each quote must have an author (starting with ~). Quotes are separated by blank lines.</p>
<div class="table-wrapper">
<table id="quotesTable" style="width:100%;border-collapse:collapse;margin:10px 0;">
<thead><tr style="background:#333;"><th style="padding:10px;text-align:left;width:70%;">Quote</th><th style="padding:10px;text-align:left;width:25%;">Author</th><th style="padding:10px;text-align:center;width:5%;"></th></tr></thead>
<tbody id="quotesRows"></tbody>
</table>
</div>
<button onclick="addQuoteRow()">Add New Quote</button>
<button onclick="loadQuotes()">Load from Device</button>
<button onclick="saveQuotes()">Save to Device</button>
<div id="quotesStatus"></div></div>
<div class="section"><h2>Media Mappings (media.csv)</h2>
<p>Configure image and audio file combinations with optional text overlay settings. Only Image is required. Check the "Next" box to set which item will be displayed next. Click "Show" to display the image and play audio on the panel.</p>
<div class="table-wrapper">
<table id="mediaTable" style="width:100%;border-collapse:collapse;margin:10px 0;min-width:800px;">
<thead><tr style="background:#333;"><th style="padding:10px;text-align:left;width:20%;">Image</th><th style="padding:10px;text-align:left;width:20%;">Audio</th><th style="padding:10px;text-align:left;width:12%;">Foreground</th><th style="padding:10px;text-align:left;width:12%;">Outline</th><th style="padding:10px;text-align:left;width:12%;">Font</th><th style="padding:10px;text-align:left;width:10%;">Thickness</th><th id="nextHeader" style="padding:10px;text-align:center;width:8%;">Next</th><th style="padding:10px;text-align:center;width:8%;">Actions</th><th style="padding:10px;width:8%;"></th></tr></thead>
<tbody id="mediaRows"></tbody>
</table>
</div>
<button onclick="addMediaRow()">Add New Row</button>
<button onclick="loadMedia()">Load from Device</button>
<button onclick="saveMedia()">Save to Device</button>
<button onclick="refreshMediaFileLists()">Refresh File Lists</button>
<div id="mediaStatus"></div></div>
<div class="section"><h2>File Management</h2>
<p>Upload, download, and delete files on the SD card.</p>
<div style="margin:10px 0;"><input type="file" id="fileUpload" style="display:none;" onchange="handleFileSelect(event)"><button onclick="document.getElementById('fileUpload').click()">Upload File</button>
<button onclick="refreshFileList()">Refresh File List</button></div>
<div id="fileList" style="margin:10px 0;">Loading files...</div>
<div id="fileStatus"></div></div>
</div>
<div id="configTab" class="tab-content">
<div class="section"><h2>Device Settings</h2>
<div class="form-group">
<label>Volume (0-100%):</label>
<input type="number" id="volume" min="0" max="100" value="50">
</div>
<div class="form-group">
<label>Sleep Interval (minutes, must be factor of 60):</label>
<input type="number" id="sleepInterval" min="1" max="60" value="1">
</div>
<div class="form-group">
<label>Hour Schedule (check hours when device should wake):</label>
<div style="display:flex;flex-wrap:wrap;gap:10px;margin:10px 0;padding:10px;background:#1a1a1a;border-radius:4px;" id="hourSchedule"></div>
<div style="margin-top:10px;"><button onclick="selectAllHours()">Select All</button>
<button onclick="deselectAllHours()">Deselect All</button>
<button onclick="selectNightHours()">Select Night (6am-11pm)</button>
<button onclick="selectDayHours()">Select Day (11pm-6am)</button></div>
</div>
<button onclick="loadSettings()">Load from Device</button>
<button onclick="saveSettings()">Save to Device</button>
<div id="settingsStatus"></div></div>
<div class="section"><h2>GitHub Pages Web UI Password</h2>
<p>Set a password for the GitHub Pages web UI (MQTT-based interface). This password is used to generate HMAC signatures for secure authentication. The password is never transmitted - only HMAC signatures are sent.</p>
<div class="form-group">
<label>Password (minimum 8 characters):</label>
<input type="password" id="webUIPassword" style="width:300px;padding:8px;border:1px solid #444;border-radius:4px;background:#1a1a1a;color:#e0e0e0;font-family:monospace;" placeholder="Enter password...">
</div>
<div class="form-group">
<label>Confirm Password:</label>
<input type="password" id="webUIPasswordConfirm" style="width:300px;padding:8px;border:1px solid #444;border-radius:4px;background:#1a1a1a;color:#e0e0e0;font-family:monospace;" placeholder="Confirm password...">
</div>
<div id="passwordStatus" style="margin:10px 0;"></div>
<button onclick="checkPasswordStatus()">Check Status</button>
<button onclick="setWebUIPassword()">Set Password</button>
<div id="webUIPasswordStatus"></div></div>
<div class="section"><h2>System Log</h2>
<p>View the current system log file (read-only).</p>
<button onclick="loadLog()">Load Current Log</button>
<button onclick="loadLogArchiveList()">Load Previous Log</button>
<div id="logArchiveList" style="margin-top:10px;"></div>
<div id="logContent" style="margin:10px 0;max-height:600px;overflow-y:auto;background:#1a1a1a;padding:10px;border:1px solid #444;border-radius:4px;font-family:monospace;font-size:12px;white-space:pre-wrap;word-wrap:break-word;color:#e0e0e0;"></div>
<div id="logStatus"></div></div>
</div>
<div id="closeStatus" style="position:fixed;top:60px;right:20px;z-index:1001;"></div>
<div id="otaStatus" style="position:fixed;top:60px;right:20px;z-index:1001;"></div>
<script>
function switchTab(tabName){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));event.target.classList.add('active');document.getElementById(tabName+'Tab').classList.add('active');}
function createQuoteRow(quote='',author=''){const row=document.createElement('tr');row.dataset.index=document.getElementById('quotesRows').children.length;const quoteCell=document.createElement('td');quoteCell.style.padding='8px';const quoteInput=document.createElement('textarea');quoteInput.className='quoteInput';quoteInput.value=quote;quoteInput.style.width='100%';quoteInput.style.height='50px';quoteInput.style.padding='5px';quoteInput.style.border='1px solid #444';quoteInput.style.borderRadius='4px';quoteInput.style.boxSizing='border-box';quoteInput.style.fontFamily='monospace';quoteInput.style.fontSize='12px';quoteInput.style.background='#1a1a1a';quoteInput.style.color='#e0e0e0';quoteInput.style.resize='vertical';quoteCell.appendChild(quoteInput);const authorCell=document.createElement('td');authorCell.style.padding='8px';const authorInput=document.createElement('input');authorInput.type='text';authorInput.className='authorInput';authorInput.value=author;authorInput.placeholder='~Author Name';authorInput.style.width='100%';authorInput.style.padding='5px';authorInput.style.border='1px solid #444';authorInput.style.borderRadius='4px';authorInput.style.boxSizing='border-box';authorInput.style.background='#1a1a1a';authorInput.style.color='#e0e0e0';authorCell.appendChild(authorInput);const actionCell=document.createElement('td');actionCell.style.padding='8px';actionCell.style.textAlign='center';const delBtn=document.createElement('button');delBtn.className='delete';delBtn.textContent='‚úï';delBtn.title='Delete';delBtn.onclick=function(){row.remove();updateQuoteRowIndices();};actionCell.appendChild(delBtn);row.appendChild(quoteCell);row.appendChild(authorCell);row.appendChild(actionCell);return row;}
function updateQuoteRowIndices(){const rows=document.querySelectorAll('#quotesRows tr');rows.forEach((row,idx)=>{row.dataset.index=idx;});}
function addQuoteRow(){const container=document.getElementById('quotesRows');container.appendChild(createQuoteRow());}
function loadQuotes(){fetch('/api/quotes').then(r=>r.json()).then(quotes=>{const container=document.getElementById('quotesRows');container.innerHTML='';quotes.forEach(q=>{container.appendChild(createQuoteRow(q.quote||'',q.author||''));});updateQuoteRowIndices();if(container.children.length===0)addQuoteRow();showStatus('quotesStatus','Loaded successfully',false);}).catch(e=>{showStatus('quotesStatus','Error: '+e,true);});}
function saveQuotes(){const rows=document.querySelectorAll('#quotesRows tr');let content='';let hasError=false;let errorMsg='';rows.forEach((row,idx)=>{const quote=row.querySelector('.quoteInput').value.trim();const author=row.querySelector('.authorInput').value.trim();if(quote.length>0&&author.length===0){hasError=true;errorMsg='Quote at row '+(idx+1)+' has no author';}if(quote.length>0||author.length>0){if(quote.length===0&&author.length>0){hasError=true;errorMsg='Row '+(idx+1)+' has author but no quote text';}if(!hasError){content+=quote;content+='\n~';content+=author;content+='\n\n';}}});if(hasError){showStatus('quotesStatus','Error: '+errorMsg,true);return;}const saveData={content:content.trim()};fetch('/api/quotes',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(saveData)}).then(r=>r.json()).then(d=>{showStatus('quotesStatus',d.success?'Saved successfully':'Error: '+d.error,d.success?false:true);if(d.success)loadQuotes();}).catch(e=>showStatus('quotesStatus','Error: '+e,true));}
let imageFiles=[];let audioFiles=[];let fontList=[];let filesLoaded=0;
function checkAndLoadMedia(){if(filesLoaded>=3){loadMedia();}else if(filesLoaded>=2){showStatus('mediaStatus','Warning: Only partial file list loaded',true);}}
function loadFileLists(){filesLoaded=0;fetch('/api/images').then(r=>r.json()).then(f=>{imageFiles=f;filesLoaded++;checkAndLoadMedia();}).catch(e=>{showStatus('mediaStatus','Error loading images: '+e,true);filesLoaded++;checkAndLoadMedia();});fetch('/api/audio').then(r=>r.json()).then(f=>{audioFiles=f;filesLoaded++;checkAndLoadMedia();}).catch(e=>{showStatus('mediaStatus','Error loading audio: '+e,true);filesLoaded++;checkAndLoadMedia();});fetch('/api/fonts').then(r=>r.json()).then(f=>{fontList=f;filesLoaded++;checkAndLoadMedia();}).catch(e=>{showStatus('mediaStatus','Error loading fonts: '+e,true);filesLoaded++;checkAndLoadMedia();});}
function refreshMediaFileLists(){showStatus('mediaStatus','Refreshing file lists...',false);Promise.all([fetch('/api/images').then(r=>r.json()).catch(e=>{showStatus('mediaStatus','Error loading images: '+e,true);return [];}),fetch('/api/audio').then(r=>r.json()).catch(e=>{showStatus('mediaStatus','Error loading audio: '+e,true);return [];}),fetch('/api/fonts').then(r=>r.json()).catch(e=>{showStatus('mediaStatus','Error loading fonts: '+e,true);return [];})]).then(([images,audio,fonts])=>{imageFiles=images;audioFiles=audio;fontList=fonts;const rows=document.querySelectorAll('#mediaRows tr');rows.forEach(row=>{const imgSelect=row.querySelector('.imageSelect');if(imgSelect){const selected=imgSelect.value;imgSelect.innerHTML='<option value="">-- Select Image --</option>';imageFiles.forEach(f=>{const opt=document.createElement('option');opt.value=f;opt.text=f;opt.selected=(opt.value===selected);imgSelect.appendChild(opt);});}const audSelect=row.querySelector('.audioSelect');if(audSelect){const selected=audSelect.value;audSelect.innerHTML='<option value="">(none)</option>';audioFiles.forEach(f=>{const opt=document.createElement('option');opt.value=f;opt.text=f;opt.selected=(opt.value===selected);audSelect.appendChild(opt);});}const fontSelect=row.querySelector('.fontSelect');if(fontSelect){const selected=fontSelect.value;fontSelect.innerHTML='<option value="">(default - OpenSans)</option>';fontList.forEach(f=>{const opt=document.createElement('option');const fontName=f.name||f.filename||'';opt.value=fontName;opt.text=fontName;opt.selected=(opt.value===selected);fontSelect.appendChild(opt);});}});showStatus('mediaStatus','File lists refreshed successfully',false);});}
let showInProgress=false;
const expectedCSVColumns=['Image','Audio','Foreground','Outline','Font','Thickness'];
function parseCSVLine(line){const fields=[];let currentField='';let inQuotes=false;for(let i=0;i<line.length;i++){const ch=line[i];if(ch==='"'){if(inQuotes&&i+1<line.length&&line[i+1]==='"'){currentField+='"';i++;}else{inQuotes=!inQuotes;}}else if(ch===','&&!inQuotes){fields.push(currentField);currentField='';}else{currentField+=ch;}}fields.push(currentField);return fields;}
function escapeCSVField(field){if(field.indexOf(',')>=0||field.indexOf('"')>=0||field.indexOf('\n')>=0){return'"'+field.replace(/"/g,'""')+'"';}return field;}
function createMediaRow(image='',audio='',foreground='',outline='',font='',thickness='',isNext=false,shuffleMode=false){const row=document.createElement('tr');row.dataset.index=document.getElementById('mediaRows').children.length;const imgCell=document.createElement('td');const imgSelect=document.createElement('select');imgSelect.className='imageSelect';imgSelect.style.background='#1a1a1a';imgSelect.style.color='#e0e0e0';imgSelect.style.border='1px solid #444';imgSelect.style.width='100%';imgSelect.innerHTML='<option value="">-- Select Image --</option>';imageFiles.forEach(f=>{const opt=document.createElement('option');opt.value=f;opt.text=f;opt.selected=(f===image);imgSelect.appendChild(opt);});imgCell.appendChild(imgSelect);const audCell=document.createElement('td');const audSelect=document.createElement('select');audSelect.className='audioSelect';audSelect.style.background='#1a1a1a';audSelect.style.color='#e0e0e0';audSelect.style.border='1px solid #444';audSelect.style.width='100%';audSelect.innerHTML='<option value="">(none)</option>';audioFiles.forEach(f=>{const opt=document.createElement('option');opt.value=f;opt.text=f;opt.selected=(f===audio);audSelect.appendChild(opt);});audCell.appendChild(audSelect);const fgCell=document.createElement('td');const fgSelect=document.createElement('select');fgSelect.className='foregroundSelect';fgSelect.style.background='#1a1a1a';fgSelect.style.color='#e0e0e0';fgSelect.style.border='1px solid #444';fgSelect.style.width='100%';fgSelect.innerHTML='<option value="">(default)</option><option value="black"'+(foreground==='black'?' selected':'')+'>Black</option><option value="white"'+(foreground==='white'?' selected':'')+'>White</option><option value="yellow"'+(foreground==='yellow'?' selected':'')+'>Yellow</option><option value="red"'+(foreground==='red'?' selected':'')+'>Red</option><option value="blue"'+(foreground==='blue'?' selected':'')+'>Blue</option><option value="green"'+(foreground==='green'?' selected':'')+'>Green</option>';fgCell.appendChild(fgSelect);const outCell=document.createElement('td');const outSelect=document.createElement('select');outSelect.className='outlineSelect';outSelect.style.background='#1a1a1a';outSelect.style.color='#e0e0e0';outSelect.style.border='1px solid #444';outSelect.style.width='100%';outSelect.innerHTML='<option value="">(default)</option><option value="black"'+(outline==='black'?' selected':'')+'>Black</option><option value="white"'+(outline==='white'?' selected':'')+'>White</option><option value="yellow"'+(outline==='yellow'?' selected':'')+'>Yellow</option><option value="red"'+(outline==='red'?' selected':'')+'>Red</option><option value="blue"'+(outline==='blue'?' selected':'')+'>Blue</option><option value="green"'+(outline==='green'?' selected':'')+'>Green</option>';outCell.appendChild(outSelect);const fontCell=document.createElement('td');const fontSelect=document.createElement('select');fontSelect.className='fontSelect';fontSelect.style.background='#1a1a1a';fontSelect.style.color='#e0e0e0';fontSelect.style.border='1px solid #444';fontSelect.style.width='100%';fontSelect.innerHTML='<option value="">(default - OpenSans)</option>';fontList.forEach(f=>{const opt=document.createElement('option');const fontName=f.name||f.filename||'';opt.value=fontName;opt.text=fontName;opt.selected=(fontName===font);fontSelect.appendChild(opt);});fontCell.appendChild(fontSelect);const thicknessCell=document.createElement('td');const thicknessInput=document.createElement('input');thicknessInput.type='number';thicknessInput.className='thicknessInput';thicknessInput.value=thickness||'';thicknessInput.min='1';thicknessInput.max='10';thicknessInput.style.background='#1a1a1a';thicknessInput.style.color='#e0e0e0';thicknessInput.style.border='1px solid #444';thicknessInput.style.width='100%';thicknessInput.style.padding='4px';thicknessInput.placeholder='(default: 3)';thicknessCell.appendChild(thicknessInput);const nextCell=document.createElement('td');nextCell.style.textAlign='center';const nextCheck=document.createElement('input');nextCheck.type='checkbox';nextCheck.className='nextCheckbox';nextCheck.checked=isNext;nextCheck.disabled=shuffleMode;if(shuffleMode){nextCheck.style.opacity='0.5';nextCheck.style.cursor='not-allowed';}nextCheck.onchange=function(){document.querySelectorAll('.nextCheckbox').forEach(cb=>{if(cb!==nextCheck)cb.checked=false;});};nextCell.appendChild(nextCheck);const actionCell=document.createElement('td');actionCell.style.textAlign='center';const showBtn=document.createElement('button');showBtn.className='showBtn';showBtn.textContent='Show';showBtn.style.margin='2px';showBtn.style.padding='4px 8px';showBtn.style.fontSize='12px';showBtn.disabled=showInProgress;showBtn.onclick=function(){if(showInProgress){alert('Another show operation is in progress. Please wait.');return;}const idx=parseInt(row.dataset.index);showMediaItem(idx);};actionCell.appendChild(showBtn);const delCell=document.createElement('td');const delBtn=document.createElement('button');delBtn.className='delete';delBtn.textContent='‚úï';delBtn.title='Delete';delBtn.onclick=function(){row.remove();updateRowIndices();};delCell.appendChild(delBtn);row.appendChild(imgCell);row.appendChild(audCell);row.appendChild(fgCell);row.appendChild(outCell);row.appendChild(fontCell);row.appendChild(thicknessCell);row.appendChild(nextCell);row.appendChild(actionCell);row.appendChild(delCell);return row;}
function showMediaItem(index){if(showInProgress){return;}showInProgress=true;document.querySelectorAll('.showBtn').forEach(btn=>btn.disabled=true);showStatus('mediaStatus','Displaying image and playing audio (this will take 20-30 seconds)...',false);fetch('/api/media/show?index='+index,{method:'POST'}).then(r=>r.json()).then(d=>{showInProgress=false;document.querySelectorAll('.showBtn').forEach(btn=>btn.disabled=false);if(d.success){showStatus('mediaStatus','Display updated successfully. Next item: '+(d.nextIndex+1),false);loadMedia();}else{showStatus('mediaStatus','Error: '+d.error,true);}}).catch(e=>{showInProgress=false;document.querySelectorAll('.showBtn').forEach(btn=>btn.disabled=false);showStatus('mediaStatus','Error: '+e,true);});}
function updateRowIndices(){const rows=document.querySelectorAll('#mediaRows tr');rows.forEach((row,idx)=>{row.dataset.index=idx;});}
function addMediaRow(){const tbody=document.getElementById('mediaRows');tbody.appendChild(createMediaRow('','','','','','',false));}
function loadMedia(){Promise.all([fetch('/api/media').then(r=>r.text()),fetch('/api/media/index').then(r=>r.json())]).then(([content,indexData])=>{const tbody=document.getElementById('mediaRows');tbody.innerHTML='';const lastDisplayedIndex=indexData.index||0;const shuffleMode=indexData.shuffle_mode||false;const nextHeader=document.getElementById('nextHeader');if(nextHeader){nextHeader.style.opacity=shuffleMode?'0.5':'1';nextHeader.style.color=shuffleMode?'#888':'inherit';}const lines=content.split('\n');let headerRead=false;let headerFields=[];let columnMap={};let dataLines=[];lines.forEach((line,idx)=>{line=line.trim();if(line.length===0||line.startsWith('#'))return;if(!headerRead){headerFields=parseCSVLine(line);headerFields.forEach((col,idx)=>{const colLower=col.trim().toLowerCase();expectedCSVColumns.forEach(expectedCol=>{if(expectedCol.toLowerCase()===colLower){columnMap[expectedCol]=idx;}});});headerRead=true;return;}dataLines.push(line);});const mediaCount=dataLines.length;const nextIndex=(lastDisplayedIndex+1)%mediaCount;dataLines.forEach((line,idx)=>{const fields=parseCSVLine(line);const getField=(colName)=>{const colIdx=columnMap[colName];return(colIdx!==undefined&&fields[colIdx]!==undefined)?fields[colIdx].trim():'';};const img=getField('Image');const aud=getField('Audio');const fg=getField('Foreground');const out=getField('Outline');const font=getField('Font');const thickness=getField('Thickness');const isNext=(idx===nextIndex);tbody.appendChild(createMediaRow(img,aud,fg,out,font,thickness,isNext,shuffleMode));});updateRowIndices();if(tbody.children.length===0)addMediaRow();showStatus('mediaStatus','Loaded successfully',false);}).catch(e=>{showStatus('mediaStatus','Error: '+e,true);});}
function saveMedia(){const rows=document.querySelectorAll('#mediaRows tr');let content=expectedCSVColumns.join(',')+'\n';let nextIndex=-1;rows.forEach((row,idx)=>{const img=row.querySelector('.imageSelect').value.trim();const aud=row.querySelector('.audioSelect').value.trim();const fg=row.querySelector('.foregroundSelect').value.trim();const out=row.querySelector('.outlineSelect').value.trim();const font=row.querySelector('.fontSelect').value.trim();const thickness=row.querySelector('.thicknessInput').value.trim();const isNext=row.querySelector('.nextCheckbox').checked;if(isNext)nextIndex=idx;if(img.length>0){const values={Image:img,Audio:aud,Foreground:fg,Outline:out,Font:font,Thickness:thickness};const rowFields=expectedCSVColumns.map(col=>escapeCSVField(values[col]||''));content+=rowFields.join(',')+'\n';}});const saveData={content:content,nextIndex:nextIndex>=0?nextIndex:null};fetch('/api/media',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(saveData)}).then(r=>r.json()).then(d=>{showStatus('mediaStatus',d.success?'Saved successfully':'Error: '+d.error,d.success?false:true);if(d.success)loadMedia();}).catch(e=>showStatus('mediaStatus','Error: '+e,true));}
function loadSettings(){fetch('/api/settings').then(r=>r.json()).then(d=>{document.getElementById('volume').value=d.volume;document.getElementById('sleepInterval').value=d.sleepInterval;if(d.hourSchedule){const schedule=d.hourSchedule;document.querySelectorAll('.hourCheckbox').forEach(cb=>{const hour=parseInt(cb.dataset.hour);cb.checked=schedule[hour]==='1'||schedule[hour]===true;});}showStatus('settingsStatus','Loaded successfully',false);}).catch(e=>showStatus('settingsStatus','Error: '+e,true));}
function saveSettings(){const hourSchedule=[];document.querySelectorAll('.hourCheckbox').forEach(cb=>{hourSchedule.push(cb.checked?'1':'0');});const json=JSON.stringify({volume:parseInt(document.getElementById('volume').value),sleepInterval:parseInt(document.getElementById('sleepInterval').value),hourSchedule:hourSchedule.join('')});fetch('/api/settings',{method:'POST',headers:{'Content-Type':'application/json'},body:json}).then(r=>r.json()).then(d=>{showStatus('settingsStatus',d.success?'Saved successfully':'Error: '+d.error,d.success?false:true);if(d.success)loadSettings();}).catch(e=>showStatus('settingsStatus','Error: '+e,true));}
function selectAllHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>cb.checked=true);}
function deselectAllHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>cb.checked=false);}
function selectNightHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>{const hour=parseInt(cb.dataset.hour);cb.checked=(hour>=6&&hour<23);});}
function selectDayHours(){document.querySelectorAll('.hourCheckbox').forEach(cb=>{const hour=parseInt(cb.dataset.hour);cb.checked=(hour>=23||hour<6);});}
function checkPasswordStatus(){fetch('/api/auth/status').then(r=>r.json()).then(d=>{const status=d.password_configured?'Password is configured':'Password is NOT configured';showStatus('webUIPasswordStatus',status,d.password_configured?false:true);}).catch(e=>showStatus('webUIPasswordStatus','Error: '+e,true));}
function setWebUIPassword(){const password=document.getElementById('webUIPassword').value;const confirm=document.getElementById('webUIPasswordConfirm').value;if(password.length===0){showStatus('webUIPasswordStatus','Error: Password cannot be empty',true);return;}if(password.length<8){showStatus('webUIPasswordStatus','Error: Password must be at least 8 characters',true);return;}if(password!==confirm){showStatus('webUIPasswordStatus','Error: Passwords do not match',true);return;}fetch('/api/auth/password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:password})}).then(r=>r.json()).then(d=>{showStatus('webUIPasswordStatus',d.success?d.message||'Password set successfully':'Error: '+d.error,d.success?false:true);if(d.success){document.getElementById('webUIPassword').value='';document.getElementById('webUIPasswordConfirm').value='';checkPasswordStatus();}}).catch(e=>showStatus('webUIPasswordStatus','Error: '+e,true));}
let fileListData=[];let fileListSortCol='name';let fileListSortDir=1;let currentDir='';
function formatDate(timestamp){if(!timestamp||timestamp===0)return'N/A';const d=new Date(timestamp);return d.toLocaleString();}
function sortFileList(col){if(fileListSortCol===col){fileListSortDir*=-1;}else{fileListSortCol=col;fileListSortDir=1;}renderFileList();}
function escapeHtml(str){const div=document.createElement('div');div.textContent=str;return div.innerHTML;}
function escapeJs(str){return str.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,'\\n').replace(/\r/g,'\\r');}
function navigateToDir(dirPath){currentDir=dirPath;refreshFileList();}
function renderFileList(){const list=document.getElementById('fileList');if(fileListData.length===0){list.innerHTML='<p>No files found'+(currentDir?' in '+currentDir:'')+'.</p>';return;}const sorted=fileListData.slice().sort((a,b)=>{let valA,valB;if(fileListSortCol==='name'){valA=a.name.toLowerCase();valB=b.name.toLowerCase();}else if(fileListSortCol==='size'){valA=a.size;valB=b.size;}else if(fileListSortCol==='modified'){valA=a.modified||0;valB=b.modified||0;}return valA<valB?-1*fileListSortDir:valA>valB?1*fileListSortDir:0;});let html='';if(currentDir){const parts=currentDir.split('/').filter(p=>p.length>0);html+='<div style="margin-bottom:10px;padding:8px;background:#333;border-radius:4px;"><span style="cursor:pointer;color:#4CAF50;" onclick="navigateToDir(\'\')">Root</span>';parts.forEach((part,idx)=>{const path=parts.slice(0,idx+1).join('/');html+=` / <span style="cursor:pointer;color:#4CAF50;" onclick="navigateToDir('${path}')">${escapeHtml(part)}</span>`;});html+='</div>';}html+='<table style="width:100%;border-collapse:collapse;"><thead><tr style="background:#333;">';html+=`<th style="padding:8px;text-align:left;cursor:pointer;" onclick="sortFileList('name')">Name ${fileListSortCol==='name'?(fileListSortDir>0?'‚ñ≤':'‚ñº'):''}</th>`;html+=`<th style="padding:8px;text-align:right;cursor:pointer;" onclick="sortFileList('size')">Size ${fileListSortCol==='size'?(fileListSortDir>0?'‚ñ≤':'‚ñº'):''}</th>`;html+=`<th style="padding:8px;text-align:left;cursor:pointer;" onclick="sortFileList('modified')">Last Modified ${fileListSortCol==='modified'?(fileListSortDir>0?'‚ñ≤':'‚ñº'):''}</th>`;html+='<th style="padding:8px;text-align:center;width:200px;">Actions</th></tr></thead><tbody>';sorted.forEach(f=>{const size=f.isDir?'&lt;DIR&gt;':f.size>=1024*1024?(f.size/(1024*1024)).toFixed(2)+' MB':f.size>=1024?(f.size/1024).toFixed(2)+' KB':f.size+' B';const modified=formatDate(f.modified);const nameEscaped=escapeJs(f.name);const pathEscaped=escapeJs(f.path);const nameHtml=escapeHtml(f.name);if(f.isDir){html+=`<tr><td style="padding:8px;"><span style="cursor:pointer;color:#4CAF50;font-weight:bold;" onclick="navigateToDir('${pathEscaped}')">üìÅ ${nameHtml}</span></td><td style="padding:8px;text-align:right;">${size}</td><td style="padding:8px;">${modified}</td><td style="padding:8px;text-align:center;"><button onclick="renameFile('${pathEscaped}','${nameEscaped}')" style="margin:2px;padding:4px 8px;font-size:12px;">Rename</button><button onclick="deleteFile('${pathEscaped}')" class="delete" title="Delete">‚úï</button></td></tr>`;}else{html+=`<tr><td style="padding:8px;">${nameHtml}</td><td style="padding:8px;text-align:right;">${size}</td><td style="padding:8px;">${modified}</td><td style="padding:8px;text-align:center;"><button onclick="downloadFile('${pathEscaped}')" style="margin:2px;padding:4px 8px;font-size:12px;">Download</button><button onclick="renameFile('${pathEscaped}','${nameEscaped}')" style="margin:2px;padding:4px 8px;font-size:12px;">Rename</button><button onclick="deleteFile('${pathEscaped}')" class="delete" title="Delete">‚úï</button></td></tr>`;}});html+='</tbody></table>';list.innerHTML=html;}
function refreshFileList(){const url=currentDir?'/api/files?dir='+encodeURIComponent(currentDir):'/api/files';fetch(url).then(r=>r.json()).then(files=>{fileListData=files;fileListSortCol='name';fileListSortDir=1;renderFileList();showStatus('fileStatus','File list refreshed',false);}).catch(e=>{showStatus('fileStatus','Error loading files: '+e,true);});}
function downloadFile(filepath){window.location.href='/api/files/'+encodeURIComponent(filepath);showStatus('fileStatus','Downloading '+filepath,false);}
function deleteFile(filepath){const name=filepath.split('/').pop();if(confirm('Delete '+name+'?')){fetch('/api/files/'+encodeURIComponent(filepath),{method:'DELETE'}).then(r=>r.json()).then(d=>{showStatus('fileStatus',d.success?'Deleted successfully':'Error: '+d.error,d.success?false:true);if(d.success)refreshFileList();}).catch(e=>showStatus('fileStatus','Error: '+e,true));}}
function renameFile(filepath,oldName){const newName=prompt('Enter new name:',oldName);if(newName&&newName!==oldName){fetch('/api/files/'+encodeURIComponent(filepath),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({newname:newName})}).then(r=>r.json()).then(d=>{showStatus('fileStatus',d.success?'Renamed successfully':'Error: '+d.error,d.success?false:true);if(d.success)refreshFileList();}).catch(e=>showStatus('fileStatus','Error: '+e,true));}}
function uploadFileChunked(file,base64Data,chunkSize){const totalChunks=Math.ceil(base64Data.length/chunkSize);let uploadedChunks=0;function uploadChunk(index){const start=index*chunkSize;const end=Math.min(start+chunkSize,base64Data.length);const chunk=base64Data.substring(start,end);const payload=JSON.stringify({filename:file.name,chunkIndex:index,totalChunks:totalChunks,chunkData:chunk});fetch('/api/files/upload/chunk',{method:'POST',headers:{'Content-Type':'application/json'},body:payload}).then(r=>r.json()).then(d=>{if(d.success){uploadedChunks++;const progress=Math.round((uploadedChunks/totalChunks)*100);showStatus('fileStatus','Uploading '+file.name+'... '+progress+'%',false);if(uploadedChunks<totalChunks){uploadChunk(uploadedChunks);}else{showStatus('fileStatus','Uploaded successfully ('+d.size+' bytes)',false);refreshFileList();document.getElementById('fileUpload').value='';}}else{showStatus('fileStatus','Error: '+d.error,true);}}).catch(e=>{showStatus('fileStatus','Error uploading chunk: '+e,true);});}uploadChunk(0);}
function handleFileSelect(event){const file=event.target.files[0];if(!file)return;showStatus('fileStatus','Reading '+file.name+'...',false);const reader=new FileReader();reader.onload=function(e){const base64Data=e.target.result;const base64Content=base64Data.substring(base64Data.indexOf(',')+1);const decodedSizeKB=(base64Content.length*3/4/1024).toFixed(1);const base64SizeKB=(base64Content.length/1024).toFixed(1);const chunkSize=300*1024;const maxSingleRequestSize=400*1024;const uploadUrl=currentDir?'/api/files/upload?dir='+encodeURIComponent(currentDir):'/api/files/upload';if(base64Content.length>maxSingleRequestSize){showStatus('fileStatus','File is large ('+decodedSizeKB+' KB decoded, '+base64SizeKB+' KB base64), using chunked upload...',false);uploadFileChunked(file,base64Content,chunkSize,currentDir);}else{const payload=JSON.stringify({filename:file.name,data:base64Content});showStatus('fileStatus','Uploading '+file.name+'...',false);fetch(uploadUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:payload}).then(r=>r.json()).then(d=>{showStatus('fileStatus',d.success?'Uploaded successfully ('+d.size+' bytes)':'Error: '+d.error,d.success?false:true);if(d.success){refreshFileList();document.getElementById('fileUpload').value='';}}).catch(e=>{showStatus('fileStatus','Error: '+e,true);});}};reader.onerror=function(e){showStatus('fileStatus','Error reading file',true);};reader.readAsDataURL(file);}
function uploadFileChunked(file,base64Data,chunkSize,uploadDir=''){const totalChunks=Math.ceil(base64Data.length/chunkSize);let uploadedChunks=0;const uploadUrl=uploadDir?'/api/files/upload/chunk?dir='+encodeURIComponent(uploadDir):'/api/files/upload/chunk';function uploadChunk(index){const start=index*chunkSize;const end=Math.min(start+chunkSize,base64Data.length);const chunk=base64Data.substring(start,end);const payload=JSON.stringify({filename:file.name,chunkIndex:index,totalChunks:totalChunks,chunkData:chunk});fetch(uploadUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:payload}).then(r=>r.json()).then(d=>{if(d.success){uploadedChunks++;const progress=Math.round((uploadedChunks/totalChunks)*100);showStatus('fileStatus','Uploading '+file.name+'... '+progress+'%',false);if(uploadedChunks<totalChunks){uploadChunk(uploadedChunks);}else{showStatus('fileStatus','Uploaded successfully ('+d.size+' bytes)',false);refreshFileList();document.getElementById('fileUpload').value='';}}else{showStatus('fileStatus','Error: '+d.error,true);}}).catch(e=>{showStatus('fileStatus','Error uploading chunk: '+e,true);});}uploadChunk(0);}
function loadLog(){logFlush();fetch('/api/log').then(r=>r.text()).then(content=>{document.getElementById('logContent').textContent=content;showStatus('logStatus','Log loaded',false);}).catch(e=>{showStatus('logStatus','Error loading log: '+e,true);document.getElementById('logContent').textContent='Error: '+e;});}
function loadLogArchiveList(){fetch('/api/log/list').then(r=>r.json()).then(files=>{const listDiv=document.getElementById('logArchiveList');if(files.length===0){listDiv.innerHTML='<p style="color:#999;">No archived log files found. Log rotation has not occurred yet.</p>';return;}let html='<p><strong>Recent archived logs (most recent first):</strong></p><div style="display:flex;flex-direction:column;gap:5px;">';files.forEach((file,idx)=>{const filenameEscaped=file.filename.replace(/"/g,'&quot;').replace(/'/g,'&#39;');html+='<button onclick="loadLogArchive(\''+filenameEscaped+'\')" style="text-align:left;padding:8px;">'+file.filename+' ('+formatFileSize(file.size)+')</button>';});html+='</div>';listDiv.innerHTML=html;showStatus('logStatus','Found '+files.length+' archived log file(s)',false);}).catch(e=>{showStatus('logStatus','Error loading archive list: '+e,true);document.getElementById('logArchiveList').innerHTML='<p style="color:red;">Error: '+e+'</p>';});}
function loadLogArchive(filename){const url=filename?'/api/log/archive?file='+encodeURIComponent(filename):'/api/log/archive';fetch(url).then(r=>{if(!r.ok){return r.text().then(text=>{throw new Error(text);});}return r.text();}).then(content=>{document.getElementById('logContent').textContent=content;showStatus('logStatus',filename?'Archive log loaded: '+filename:'Archive log loaded',false);}).catch(e=>{showStatus('logStatus','Error loading archive: '+e,true);document.getElementById('logContent').textContent='Error: '+e;});}
function formatFileSize(bytes){if(bytes<1024)return bytes+' B';if(bytes<1024*1024)return (bytes/1024).toFixed(1)+' KB';return (bytes/(1024*1024)).toFixed(1)+' MB';}
function logFlush(){fetch('/api/log/flush',{method:'POST'});}
function closeServer(){if(confirm('Close management interface and return to normal operation?')){fetch('/api/close',{method:'POST'}).then(r=>r.json()).then(d=>{showStatus('closeStatus','Management interface closed. You can close this page.',false);setTimeout(()=>{window.location.href='about:blank';},2000);}).catch(e=>showStatus('closeStatus','Error: '+e,true));}}
function startOTA(){if(confirm('Start OTA update mode? The device will listen for firmware updates for 10 minutes. You can then upload firmware to /update endpoint.')){showStatus('otaStatus','Starting OTA server...',false);fetch('/api/ota/start',{method:'POST'}).then(r=>r.json()).then(d=>{if(d.success){showStatus('otaStatus','OTA server started! Upload firmware to: '+d.url,false);}else{showStatus('otaStatus','Error: '+d.error,true);}}).catch(e=>{showStatus('otaStatus','Error: '+e,true);});}}
function triggerHappyWeather(){showStatus('otaStatus','Triggering Happy Place Weather scene...',false);fetch('/api/scene/happy',{method:'POST'}).then(r=>r.json()).then(d=>{if(d.success){showStatus('otaStatus','Happy Place Weather scene triggered!',false);}else{showStatus('otaStatus','Error: '+d.error,true);}}).catch(e=>{showStatus('otaStatus','Error: '+e,true);});}
function toggleTimeoutDisabled(){const checkbox=document.getElementById('timeoutDisabledCheckbox');const disable=checkbox.checked;fetch('/api/manage/timeout',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({timeout_disabled:disable})}).then(r=>r.json()).then(d=>{if(d.success){showStatus('closeStatus','Timeout disabled: '+d.timeout_disabled,false);}else{showStatus('closeStatus','Error setting timeout: '+(d.error||'Unknown error'),true);}}).catch(e=>{showStatus('closeStatus','Error: '+e,true);});}
function loadTimeoutDisabledState(){fetch('/api/manage/timeout').then(r=>r.json()).then(d=>{const checkbox=document.getElementById('timeoutDisabledCheckbox');if(checkbox){checkbox.checked=d.timeout_disabled||false;}}).catch(e=>console.error('Error loading timeout disabled state:',e));}
function showStatus(id,msg,isError){const el=document.getElementById(id);if(el){el.textContent=msg;el.className=isError?'error status':'status';}}
let lastActivityPing=0;const ACTIVITY_PING_INTERVAL=30000;function pingActivity(){const now=Date.now();if(now-lastActivityPing<ACTIVITY_PING_INTERVAL)return;lastActivityPing=now;fetch('/api/activity',{method:'POST'}).catch(()=>{});}
document.addEventListener('click',pingActivity);document.addEventListener('keydown',pingActivity);document.addEventListener('mousemove',()=>{if(Date.now()-lastActivityPing>5000)pingActivity();});document.addEventListener('touchstart',pingActivity);document.addEventListener('scroll',()=>{if(Date.now()-lastActivityPing>5000)pingActivity();});
window.onload=function(){loadQuotes();loadFileLists();loadSettings();refreshFileList();pingActivity();checkPasswordStatus();loadTimeoutDisabledState();const hourScheduleEl=document.getElementById('hourSchedule');if(hourScheduleEl){for(let i=0;i<24;i++){const cb=document.createElement('input');cb.type='checkbox';cb.className='hourCheckbox';cb.dataset.hour=i;const label=document.createElement('label');label.appendChild(cb);label.appendChild(document.createTextNode(' '+String(i).padStart(2,'0')+':00'));label.style.marginRight='10px';label.style.color='#e0e0e0';hourScheduleEl.appendChild(label);}}};
</script>
</body>
</html>

)HTML";

// Length of HTML content (for reference, not needed for null-terminated string)
const size_t WEB_HTML_CONTENT_LEN = 42747;

#endif // WEB_ASSETS_H
