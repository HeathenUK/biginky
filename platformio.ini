; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:pico_plus_2w]
platform = https://github.com/maxgerhardt/platform-raspberrypi.git
board = pimoroni_pico_plus_2w
framework = arduino
board_build.core = earlephilhower
board_build.psram_length = 0x800000

build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=40000000
	-DUSE_PSRAM=1
	-I$PROJECT_PACKAGES_DIR/framework-arduinopico/pico-sdk/src/rp2_common/hardware_powman/include
	-I$PROJECT_PACKAGES_DIR/framework-arduinopico/pico-sdk/src/rp2_common/pico_aon_timer/include
build_src_filter = 
	+<*>
	+<../../../.platformio/packages/framework-arduinopico/pico-sdk/src/rp2_common/hardware_powman/powman.c>
	+<../../../.platformio/packages/framework-arduinopico/pico-sdk/src/rp2_common/pico_aon_timer/aon_timer.c>
monitor_speed = 115200
lib_deps = 
	kikuchan98/pngle@^1.1.0
	SdFat@^2.2.3
build_type = release

; Pre-build script to regenerate color LUT if palette changes
; The LUT is stored in PROGMEM (flash) for zero runtime cost
; To regenerate manually: python scripts/generate_color_lut.py lib/EL133UF1/EL133UF1_ColorLUT.h
extra_scripts = pre:scripts/pre_build.py

; ============================================================================
; ESP32-P4-WIFI6 Configuration
; ============================================================================
; NOTE: ESP32-P4 is a new chip. Board support may require:
;   1. Latest PlatformIO espressif32 platform (or development version)
;   2. ESP-IDF 5.3+ for full P4 support
;   3. Custom board definition if not yet in PlatformIO registry
;
; Pin mapping must be adjusted for ESP32-P4-WIFI6 board schematic.
; PSRAM: ESP32-P4 supports up to 32MB PSRAM (Octal mode)
; ============================================================================

[env:esp32p4_wifi6]
; Use development version of espressif32 for ESP32-P4 support
; Once P4 is stable in mainline, change to: platform = espressif32
platform = https://github.com/pioarduino/platform-espressif32/releases/download/51.03.05/platform-espressif32.zip
; Alternative: platform = espressif32 @ ^6.8.0

; Board definition - may need custom board JSON if not in registry
; For now, use generic ESP32P4 or create custom board
board = esp32-p4-function-ev
framework = arduino

; PSRAM configuration for ESP32-P4 (Octal PSRAM)
board_build.arduino.memory_type = qio_opi
board_build.psram_mode = octal

; Build configuration
build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=40000000
	-DUSE_PSRAM=1
	-DBOARD_HAS_PSRAM
	-DCONFIG_SPIRAM_USE_MALLOC
	; ESP32-P4 pin definitions - ADJUST FOR YOUR BOARD
	-DPIN_SPI_SCK=12
	-DPIN_SPI_MOSI=11
	-DPIN_CS0=10
	-DPIN_CS1=9
	-DPIN_DC=46
	-DPIN_RESET=3
	-DPIN_BUSY=8
	; I2C for RTC (DS3231)
	-DPIN_RTC_SDA=4
	-DPIN_RTC_SCL=5
	-DPIN_RTC_INT=6
	; Target ESP32-P4 specifically
	-DCONFIG_IDF_TARGET_ESP32P4=1

; Only build the ESP32-compatible source files
; Exclude RP2350-specific files
build_src_filter = 
	+<*>
	-<../.platformio/packages/framework-arduinopico/*>

; Ignore RP2350-specific library implementations
lib_ignore = 
	pico_sleep

monitor_speed = 115200

lib_deps = 
	kikuchan98/pngle@^1.1.0
	; SdFat may need configuration for ESP32 SDMMC
	; For ESP32, consider using SD_MMC library instead
	; SdFat@^2.2.3

build_type = release

; ============================================================================
; ESP32-P4 Test Build (Minimal - Display Only)
; ============================================================================
; Use this environment for initial porting/testing
; Excludes WiFi, AI, SD card features

[env:esp32p4_minimal]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/51.03.05/platform-espressif32.zip
board = esp32-p4-function-ev
framework = arduino

board_build.arduino.memory_type = qio_opi
board_build.psram_mode = octal

build_unflags = -Os
build_flags = 
	-O2
	-DEL133UF1_SPI_SPEED=40000000
	-DUSE_PSRAM=1
	-DBOARD_HAS_PSRAM
	; Disable features for minimal test build
	-DDISABLE_WIFI=1
	-DDISABLE_SDIO_TEST=1
	-DDISABLE_AI_IMAGE=1
	-DDISABLE_SLEEP=1
	; ESP32-P4 pin definitions - ADJUST FOR YOUR BOARD
	-DPIN_SPI_SCK=12
	-DPIN_SPI_MOSI=11
	-DPIN_CS0=10
	-DPIN_CS1=9
	-DPIN_DC=46
	-DPIN_RESET=3
	-DPIN_BUSY=8
	-DCONFIG_IDF_TARGET_ESP32P4=1

build_src_filter = 
	+<*>

lib_ignore = 
	pico_sleep

monitor_speed = 115200

lib_deps = 
	kikuchan98/pngle@^1.1.0

build_type = release
