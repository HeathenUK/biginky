<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BigInky Remote Control</title>
<style>
body{font-family:Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#1a1a1a;color:#e0e0e0;}
h1{color:#e0e0e0;border-bottom:2px solid #4CAF50;padding-bottom:10px;}
.section{background:#2a2a2a;padding:20px;margin:20px 0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.3);}
h2{color:#4CAF50;margin-top:0;}
label{display:block;margin:10px 0 5px 0;font-weight:bold;color:#e0e0e0;line-height:1.4;min-height:1.4em;}
textarea{width:100%;min-height:100px;font-family:monospace;padding:10px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
select{width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:14px;transition:background-color 0.2s;}
select:hover{background-color:#333;}
select:focus{background-color:#333;outline:none;border-color:#666;}
input[type="text"]{width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;}
button{background:#4CAF50;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px;margin:5px;min-height:44px;touch-action:manipulation;-webkit-tap-highlight-color:rgba(76,175,80,0.3);}
button:hover{background:#45a049;}
button:disabled{background:#666;cursor:not-allowed;opacity:0.6;}
.status{color:#4CAF50;margin:10px 0;font-weight:bold;}
.error{color:#f44336;}
.info{color:#2196F3;margin:10px 0;padding:10px;background:#1a1a1a;border-radius:4px;border-left:3px solid #2196F3;}
.connection-status{display:inline-flex;align-items:center;gap:8px;padding:5px 10px;border-radius:4px;font-weight:bold;margin-left:10px;}
.connection-status::before{font-size:16px;}
.connected{background:#4CAF50;color:white;}
.connected::before{content:'‚úì';}
.disconnected{background:#f44336;color:white;}
.disconnected::before{content:'‚úó';}
.connecting{background:#ff9800;color:white;}
.connecting::before{content:'‚ü≥';animation:spin 1s linear infinite;}
.reconnecting{background:#ff9800;color:white;}
.reconnecting::before{content:'‚ü≥';animation:spin 1s linear infinite;}
.status-timestamp{font-size:11px;opacity:0.7;margin-left:10px;font-weight:normal;}
.flex-row{display:flex;flex-wrap:wrap;gap:15px;align-items:flex-end;margin-top:15px;}
.flex-item{flex:1;min-width:150px;}
button.flex-shrink{flex-shrink:0;margin-top:0;}
/* Canvas controls - optimized desktop layout */
.canvas-controls-wrapper{display:flex;flex-direction:column;gap:12px;}
.canvas-controls-primary{display:flex;flex-wrap:wrap;align-items:flex-start;gap:12px;}
.canvas-tools-group{flex:0 0 auto;}
.canvas-colors-group{display:flex;gap:12px;flex-wrap:wrap;flex:1 1 auto;align-items:flex-start;}
.canvas-controls-secondary{display:flex;flex-wrap:wrap;align-items:flex-start;gap:12px;}
.tool-btn{background:#333;border:2px solid #555;color:#e0e0e0;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;}
.tool-btn:hover{background:#444;border-color:#666;}
.tool-btn.active{background:#4CAF50;border-color:#45a049;color:white;}
.color-btn{transition:transform 0.1s;border-radius:4px;}
.color-btn:hover{transform:scale(1.1);border-color:#4CAF50 !important;}
.color-btn.active{border-color:#4CAF50 !important;border-width:3px !important;}
.color-preview-btn{transition:background-color 0.2s;border-radius:4px;display:flex;align-items:center;padding:4px;}
.color-preview-btn:hover{background-color:#333 !important;}
.color-palette-popup{display:flex;flex-wrap:wrap;gap:4px;}
.palette-color-btn{transition:transform 0.1s;border-radius:4px;}
.palette-color-btn:hover{transform:scale(1.1);border-color:#4CAF50 !important;}
.palette-color-btn.active{border-color:#4CAF50 !important;border-width:3px !important;}
h2{cursor:pointer;user-select:none;position:relative;padding-right:20px;}
.section h2::after{content:'‚ñº';position:absolute;right:0;font-size:14px;opacity:0.7;transition:transform 0.2s;}
.section h2.collapsed::after{transform:rotate(-90deg);}
.section-content{overflow:hidden;transition:max-height 0.3s ease-out;}
.section-content.collapsed{display:none;}
canvas{border:2px solid #666;cursor:crosshair;background:#fff;touch-action:none;margin-top:10px;display:block;max-width:100%;height:auto;-ms-touch-action:none;touch-action:none;}
.busy-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:10000;flex-direction:column;}
.busy-overlay.active{display:flex;}
.busy-overlay .message{color:#fff;font-size:18px;margin-top:20px;text-align:center;}
.spinner{border:4px solid rgba(255,255,255,0.3);border-top:4px solid #4CAF50;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:20000;padding:20px;box-sizing:border-box;}
.modal-content{background:#2a2a2a;border-radius:8px;padding:20px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,0.5);}
@media (max-width:768px){
.modal-content{padding:15px;max-width:95%;max-height:90vh;}
.modal-overlay{padding:10px;}
}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
/* Responsive design for mobile devices */
@media (max-width:768px){
body{padding:10px;}
.section{padding:15px;margin:15px 0;}
h1{font-size:24px;}
h2{font-size:20px;}
button{font-size:14px;padding:8px 16px;margin:3px;min-height:48px;}
.flex-row{gap:10px;}
.flex-item{min-width:100%;}
/* Make tables horizontally scrollable on mobile */
.table-wrapper{overflow-x:auto;-webkit-overflow-scrolling:touch;}
table{min-width:600px;font-size:14px;}
table th,table td{padding:8px;font-size:13px;}
/* Media mappings table - optimize desktop display */
#mediaMappingsTable table{min-width:auto;}
#mediaMappingsTable th,#mediaMappingsTable td{font-size:13px;}
/* Responsive thumbnails - scale down on mobile */
.media-thumbnail{max-width:150px!important;max-height:112px!important;width:auto;height:auto;}
/* Stack form elements vertically on mobile */
.flex-row{flex-direction:column;}
.flex-item{width:100%;}
button.flex-shrink{width:100%;margin-top:10px;}
/* Canvas action buttons - stack vertically on mobile */
.canvas-actions-wrapper{display:flex;flex-direction:column;gap:10px;}
.canvas-actions-primary{display:flex;flex-wrap:wrap;gap:8px;}
.canvas-actions-primary button{flex:1 1 auto;min-width:calc(50% - 4px);}
.canvas-actions-secondary{display:flex;flex-direction:column;gap:8px;width:100%;}
.canvas-filename-input{width:100%!important;}
.canvas-action-select{width:100%;}
.canvas-action-go{width:100%;}
/* Tool buttons - larger on mobile */
.tool-btn{width:48px!important;height:48px!important;min-width:48px!important;min-height:48px!important;}
.tool-btn-container{display:flex;gap:12px;flex-wrap:wrap;}
/* Canvas controls - stack on mobile */
.canvas-controls-wrapper{flex-direction:column!important;}
.canvas-controls-primary{flex-direction:column!important;gap:15px!important;}
.canvas-controls-secondary{flex-direction:column!important;gap:15px!important;}
.canvas-tools-group{width:100%;}
.canvas-colors-group{width:100%;flex-direction:column!important;gap:15px!important;}
.canvas-colors-group > div{width:100%!important;}
.canvas-controls-secondary > div{width:100%!important;}
}
@media (max-width:480px){
body{padding:8px;}
.section{padding:12px;margin:12px 0;}
h1{font-size:20px;}
h2{font-size:18px;}
button{font-size:13px;padding:8px 12px;}
table{min-width:500px;font-size:12px;}
table th,table td{padding:6px;font-size:12px;}
.media-thumbnail{max-width:120px!important;max-height:90px!important;}
.busy-overlay .message{font-size:16px;padding:0 20px;}
}
/* Image processing panel mobile optimization */
@media (max-width:768px){
.image-processing-panel .image-processing-controls{flex-direction:column;align-items:stretch!important;gap:15px;}
.image-processing-slider{width:100%!important;min-width:100%!important;}
.processing-slider{height:32px;cursor:pointer;-webkit-appearance:none;appearance:none;background:transparent;}
.processing-slider::-webkit-slider-thumb{height:20px;width:20px;-webkit-appearance:none;appearance:none;background:#4CAF50;border-radius:50%;cursor:pointer;}
.processing-slider::-moz-range-thumb{height:20px;width:20px;background:#4CAF50;border-radius:50%;cursor:pointer;border:none;}
.processing-value{display:inline-block;min-width:60px;text-align:left;font-weight:bold;}
.image-processing-checkbox{width:100%!important;min-width:100%!important;}
.checkbox-label{width:100%;padding:12px!important;border:1px solid #444;border-radius:4px;background:#1a1a1a;}
.checkbox-label:hover{background:#333;}
.image-processing-actions{width:100%!important;flex-direction:column;}
.image-processing-actions button{width:100%;}
}
</style>
<script src="https://cdn.jsdelivr.net/gh/eclipse/paho.mqtt.javascript@master/src/paho-mqtt.js" onerror="loadPahoFallback()"></script>
<!-- Load custom MQTT configuration if available, otherwise defaults will be used -->
<!-- Note: mqtt-config.js is optional - if it doesn't exist, defaults from config.js will be used -->
<script src="js/mqtt-config.js" onerror="void(0)"></script>
<!-- Load modules in dependency order -->
<script src="js/config.js"></script>
<script src="js/encryption.js"></script>
<script src="js/password.js"></script>
<script src="js/paho-loader.js"></script>
<script src="js/ui-utils.js"></script>
<script src="js/media.js"></script>
<script src="js/mqtt.js"></script>
<script src="js/color-picker.js"></script>
<script src="js/font-loader.js"></script>
<script src="js/commands.js"></script>
<script src="js/canvas.js"></script>
<script src="js/main.js"></script>
</head>
<body>
<div id="busyOverlay" class="busy-overlay">
<div class="spinner"></div>
<div class="message">Processing command... Please wait for device to respond.</div>
</div>
<div id="textInputModal" class="modal-overlay" style="display:none;">
<div class="modal-content">
<h3 style="color:#4CAF50;margin-top:0;">Enter Text</h3>
<textarea id="modalTextInput" placeholder="Enter text to place on canvas..." style="width:100%;min-height:100px;padding:10px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:16px;resize:vertical;margin-bottom:15px;"></textarea>
<div style="display:flex;gap:10px;justify-content:flex-end;">
<button onclick="cancelTextInput()" style="background:#666;">Cancel</button>
<button onclick="confirmTextInput()" style="background:#4CAF50;">Place Text</button>
</div>
</div>
</div>
<h1>BigInky Remote Control</h1>
<div class="section">
<h2 onclick="toggleSection(this)">Authentication (Required)</h2>
<div class="section-content" id="section-auth">
<div class="flex-row" style="align-items:center;gap:10px;">
<div style="flex:0 0 auto;white-space:nowrap;">
<label style="display:inline;margin:0;margin-right:8px;">Web UI Password:</label>
</div>
<div style="flex:1 1 auto;min-width:200px;">
<input type="password" id="webUIPassword" placeholder="Enter password (min 8 characters)..." onkeydown="if(event.key==='Enter'){event.preventDefault();savePassword();}" style="width:100%;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-family:monospace;height:38px;">
</div>
<div style="flex:0 0 auto;display:flex;gap:10px;">
<button onclick="savePassword()" style="height:38px;min-height:38px;padding:8px 16px;margin:0;">Save Password</button>
<button onclick="clearPassword()" style="height:38px;min-height:38px;padding:8px 16px;margin:0;background:#f44336;">Clear Password</button>
</div>
</div>
<div id="passwordStatus" style="margin-top:10px;"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Connection</h2>
<div class="section-content" id="section-connection">
<div style="text-align:center;">
<button onclick="connectMQTT()" id="connectBtn">Connect</button>
<button onclick="disconnectMQTT()" id="disconnectBtn" disabled>Disconnect</button>
<div style="margin-top:10px;">
<span id="connectionStatus" class="connection-status disconnected">Disconnected</span>
</div>
<div id="connectionStatusMsg" style="margin-top:10px;"></div>
</div>
<div style="margin-top:20px;border-top:1px solid #444;padding-top:20px;">
<h3 style="color:#4CAF50;margin-top:0;font-size:18px;">Device Status</h3>
<div id="deviceStatus" style="font-family:monospace;font-size:12px;color:#e0e0e0;">
</div>
</div>
<div style="margin-top:20px;border-top:1px solid #444;padding-top:20px;">
<h3 style="color:#4CAF50;margin-top:0;font-size:18px;">Display Preview</h3>
<div id="thumbnailContainer" style="text-align:center;margin:20px 0;">
<canvas id="thumbnailCanvas" width="400" height="300" style="border:2px solid #666;background:#fff;max-width:100%;height:auto;display:none;margin:0 auto;"></canvas>
<p id="thumbnailStatus" style="color:#888;">No preview available yet</p>
</div>
</div>
</div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Media Mappings</h2>
<div class="section-content" id="section-media">
<div id="mediaMappingsStatus" style="color:#888;margin-bottom:10px;"></div>
<div style="margin-bottom:10px;">
<button onclick="addMediaMapping()" id="addMediaBtn" disabled style="background:#2196F3;">Add New Mapping</button>
</div>
<div class="table-wrapper">
<div id="mediaMappingsTable">
<!-- Table will be populated here -->
</div>
</div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Text Display</h2>
<div class="section-content" id="section-text">
<label>Text:</label>
<textarea id="textInput" placeholder="Enter text to display..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendTextDisplay();}"></textarea>
<div class="flex-row" style="align-items:flex-start;">
<div class="flex-item" style="min-width:150px;position:relative;">
<label>Text Colour:</label>
<button type="button" id="textColorBtn" class="color-preview-btn" style="width:100%;height:40px;border:2px solid #555;cursor:pointer;background:#2a2a2a;display:flex;align-items:center;padding:4px;" title="Click to select text color">
<span id="textColorIndicator" style="display:inline-block;width:32px;height:32px;background:#1A1A1A;border:2px solid #333;margin:2px;"></span>
<span id="textColorLabel" style="margin-left:8px;font-size:14px;">Black</span>
</button>
<div id="textColorPalette" class="color-palette-popup" style="display:none;position:absolute;background:#2a2a2a;padding:8px;border:2px solid #555;border-radius:4px;z-index:1000;top:100%;left:0;">
<button class="palette-color-btn active" data-color="black" style="width:32px;height:32px;background:#1A1A1A;border:2px solid #555;cursor:pointer;margin:2px;" title="Black"></button>
<button class="palette-color-btn" data-color="yellow" style="width:32px;height:32px;background:#F0E050;border:2px solid #555;cursor:pointer;margin:2px;" title="Yellow"></button>
<button class="palette-color-btn" data-color="red" style="width:32px;height:32px;background:#A02020;border:2px solid #555;cursor:pointer;margin:2px;" title="Red"></button>
<button class="palette-color-btn" data-color="blue" style="width:32px;height:32px;background:#5080B8;border:2px solid #555;cursor:pointer;margin:2px;" title="Blue"></button>
<button class="palette-color-btn" data-color="green" style="width:32px;height:32px;background:#608050;border:2px solid #555;cursor:pointer;margin:2px;" title="Green"></button>
<button class="palette-color-btn" data-color="white" style="width:32px;height:32px;background:#F2F1E6;border:2px solid #555;cursor:pointer;margin:2px;" title="White"></button>
<button class="palette-color-btn" data-color="multi" style="width:64px;height:32px;background:linear-gradient(90deg,#1A1A1A 0%,#F0E050 16.66%,#A02020 33.33%,#5080B8 50%,#608050 66.66%,#F2F1E6 83.33%,#1A1A1A 100%);border:2px solid #555;cursor:pointer;margin:2px;font-size:10px;padding:0;display:flex;align-items:center;justify-content:center;" title="Multi (Random Colours)">Multi</button>
</div>
<input type="hidden" id="textColor" value="black">
</div>
<div class="flex-item" style="min-width:150px;position:relative;">
<label>Background Colour:</label>
<button type="button" id="textBackgroundColorBtn" class="color-preview-btn" style="width:100%;height:40px;border:2px solid #555;cursor:pointer;background:#2a2a2a;display:flex;align-items:center;padding:4px;" title="Click to select background color">
<span id="textBackgroundColorIndicator" style="display:inline-block;width:32px;height:32px;background:#F2F1E6;border:2px solid #333;margin:2px;"></span>
<span id="textBackgroundColorLabel" style="margin-left:8px;font-size:14px;">White</span>
</button>
<div id="textBackgroundColorPalette" class="color-palette-popup" style="display:none;position:absolute;background:#2a2a2a;padding:8px;border:2px solid #555;border-radius:4px;z-index:1000;top:100%;left:0;">
<button class="palette-color-btn" data-color="black" style="width:32px;height:32px;background:#1A1A1A;border:2px solid #555;cursor:pointer;margin:2px;" title="Black"></button>
<button class="palette-color-btn" data-color="yellow" style="width:32px;height:32px;background:#F0E050;border:2px solid #555;cursor:pointer;margin:2px;" title="Yellow"></button>
<button class="palette-color-btn" data-color="red" style="width:32px;height:32px;background:#A02020;border:2px solid #555;cursor:pointer;margin:2px;" title="Red"></button>
<button class="palette-color-btn" data-color="blue" style="width:32px;height:32px;background:#5080B8;border:2px solid #555;cursor:pointer;margin:2px;" title="Blue"></button>
<button class="palette-color-btn" data-color="green" style="width:32px;height:32px;background:#608050;border:2px solid #555;cursor:pointer;margin:2px;" title="Green"></button>
<button class="palette-color-btn active" data-color="white" style="width:32px;height:32px;background:#F2F1E6;border:2px solid #555;cursor:pointer;margin:2px;" title="White"></button>
</div>
<input type="hidden" id="textBackgroundColor" value="white">
</div>
<div class="flex-item">
<label>Background Image:</label>
<select id="textBackgroundImage" style="width:100%;padding:8px;border:2px solid #555;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;height:44px;font-size:14px;">
<option value="">(Use background color)</option>
</select>
</div>
<div class="flex-item" style="min-width:150px;position:relative;">
<label>Outline Colour:</label>
<button type="button" id="textOutlineColorBtn" class="color-preview-btn" style="width:100%;height:40px;border:2px solid #555;cursor:pointer;background:#2a2a2a;display:flex;align-items:center;padding:4px;" title="Click to select outline color">
<span id="textOutlineColorIndicator" style="display:inline-block;width:32px;height:32px;background:#1A1A1A;border:2px solid #333;margin:2px;"></span>
<span id="textOutlineColorLabel" style="margin-left:8px;font-size:14px;">Black</span>
</button>
<div id="textOutlineColorPalette" class="color-palette-popup" style="display:none;position:absolute;background:#2a2a2a;padding:8px;border:2px solid #555;border-radius:4px;z-index:1000;top:100%;left:0;">
<button class="palette-color-btn active" data-color="black" style="width:32px;height:32px;background:#1A1A1A;border:2px solid #555;cursor:pointer;margin:2px;" title="Black"></button>
<button class="palette-color-btn" data-color="yellow" style="width:32px;height:32px;background:#F0E050;border:2px solid #555;cursor:pointer;margin:2px;" title="Yellow"></button>
<button class="palette-color-btn" data-color="red" style="width:32px;height:32px;background:#A02020;border:2px solid #555;cursor:pointer;margin:2px;" title="Red"></button>
<button class="palette-color-btn" data-color="blue" style="width:32px;height:32px;background:#5080B8;border:2px solid #555;cursor:pointer;margin:2px;" title="Blue"></button>
<button class="palette-color-btn" data-color="green" style="width:32px;height:32px;background:#608050;border:2px solid #555;cursor:pointer;margin:2px;" title="Green"></button>
<button class="palette-color-btn" data-color="white" style="width:32px;height:32px;background:#F2F1E6;border:2px solid #555;cursor:pointer;margin:2px;" title="White"></button>
</div>
<input type="hidden" id="textOutlineColor" value="black">
</div>
<div class="flex-item">
<label>Font:</label>
<select id="textFont" style="width:100%;padding:8px;border:2px solid #555;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;height:44px;font-size:14px;">
<option value="OpenSans" selected>OpenSans (Default)</option>
</select>
</div>
<button onclick="sendTextDisplay()" class="flex-shrink" id="textDisplayBtn" disabled style="margin-top:35px;align-self:flex-start;">Display Text</button>
</div>
<div id="textStatus"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Drawing Canvas</h2>
<div class="section-content" id="section-canvas">
<div class="canvas-controls-wrapper" style="margin-bottom:8px;">
<div class="canvas-controls-row canvas-controls-primary" style="display:flex;flex-wrap:wrap;align-items:flex-end;gap:12px;margin-bottom:12px;">
<div class="canvas-tools-group" style="flex:0 0 auto;display:flex;flex-direction:column;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Tool:</label>
<div class="tool-btn-container" style="display:flex;gap:6px;flex-wrap:wrap;">
<button onclick="setTool('brush')" id="tool-brush" class="tool-btn active" title="Brush" style="width:40px;height:40px;padding:6px;font-size:18px;">üñåÔ∏è</button>
<button onclick="setTool('text')" id="tool-text" class="tool-btn" title="Text" style="width:40px;height:40px;padding:6px;font-size:18px;">T</button>
<button onclick="setTool('fill')" id="tool-fill" class="tool-btn" title="Fill" style="width:40px;height:40px;padding:6px;font-size:18px;">ü™£</button>
<button onclick="setTool('rectangle')" id="tool-rectangle" class="tool-btn" title="Rectangle" style="width:40px;height:40px;padding:6px;font-size:18px;">‚ñ≠</button>
<button onclick="setTool('roundedRect')" id="tool-roundedRect" class="tool-btn" title="Rounded Rectangle" style="width:40px;height:40px;padding:6px;font-size:18px;">‚ñ¢</button>
<button onclick="setTool('circle')" id="tool-circle" class="tool-btn" title="Circle" style="width:40px;height:40px;padding:6px;font-size:18px;">‚óã</button>
<button onclick="setTool('line')" id="tool-line" class="tool-btn" title="Line" style="width:40px;height:40px;padding:6px;font-size:18px;">/</button>
<button onclick="setTool('eraser')" id="tool-eraser" class="tool-btn" title="Eraser" style="width:40px;height:40px;padding:6px;font-size:18px;">üßπ</button>
<button onclick="setTool('eyedropper')" id="tool-eyedropper" class="tool-btn" title="Eyedropper" style="width:40px;height:40px;padding:6px;font-size:18px;">üëÅÔ∏è</button>
</div>
<input type="hidden" id="drawTool" value="brush">
</div>
<div class="canvas-colors-group" style="flex:0 0 auto;display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
<div id="brushSizeContainer" style="width:160px;display:none;flex-shrink:0;margin-top:-3px;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Brush Size:</label>
<div style="display:flex;align-items:center;gap:8px;">
<input type="range" id="brushSize" min="1" max="50" value="2" style="flex:1;min-width:0;">
<span id="brushSizeDisplay" style="flex-shrink:0;min-width:50px;text-align:right;font-size:13px;">2px</span>
</div>
</div>
<div id="colorContainer" style="width:140px;position:relative;flex-shrink:0;">
<label id="colorLabel" style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Colour:</label>
<button type="button" id="drawColorBtn" class="color-preview-btn" style="width:100%;height:38px;border:2px solid #555;cursor:pointer;background:#2a2a2a;display:flex;align-items:center;padding:4px 6px;" title="Click to select color">
<span id="drawColorIndicator" style="display:inline-block;width:28px;height:28px;background:#1A1A1A;border:2px solid #333;margin:2px;flex-shrink:0;"></span>
<span id="drawColorLabel" style="margin-left:6px;font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">Black</span>
</button>
<div id="drawColorPalette" class="color-palette-popup" style="display:none;position:absolute;background:#2a2a2a;padding:8px;border:2px solid #555;border-radius:4px;z-index:1000;margin-top:4px;top:100%;">
<button class="palette-color-btn active" data-color="0" style="width:32px;height:32px;background:#1A1A1A;border:2px solid #555;cursor:pointer;margin:2px;" title="Black"></button>
<button class="palette-color-btn" data-color="2" style="width:32px;height:32px;background:#F0E050;border:2px solid #555;cursor:pointer;margin:2px;" title="Yellow"></button>
<button class="palette-color-btn" data-color="3" style="width:32px;height:32px;background:#A02020;border:2px solid #555;cursor:pointer;margin:2px;" title="Red"></button>
<button class="palette-color-btn" data-color="5" style="width:32px;height:32px;background:#5080B8;border:2px solid #555;cursor:pointer;margin:2px;" title="Blue"></button>
<button class="palette-color-btn" data-color="6" style="width:32px;height:32px;background:#608050;border:2px solid #555;cursor:pointer;margin:2px;" title="Green"></button>
<button class="palette-color-btn" data-color="1" style="width:32px;height:32px;background:#F2F1E6;border:2px solid #555;cursor:pointer;margin:2px;" title="White"></button>
</div>
<input type="hidden" id="drawColor" value="0">
</div>
<div id="fillColorContainer" style="width:140px;display:none;position:relative;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Fill:</label>
<button type="button" id="fillColorBtn" class="color-preview-btn" style="width:100%;height:38px;border:2px solid #555;cursor:pointer;background:#2a2a2a;display:flex;align-items:center;padding:4px 6px;" title="Click to select fill color">
<span id="fillColorIndicator" style="display:inline-block;width:28px;height:28px;background:#F2F1E6;border:2px solid #333;margin:2px;flex-shrink:0;"></span>
<span id="fillColorLabel" style="margin-left:6px;font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">White</span>
</button>
<div id="fillColorPalette" class="color-palette-popup" style="display:none;position:absolute;background:#2a2a2a;padding:8px;border:2px solid #555;border-radius:4px;z-index:1000;margin-top:4px;top:100%;">
<button class="palette-color-btn" data-color="transparent" style="width:32px;height:32px;background:linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);background-size:8px 8px;background-position:0 0, 0 4px, 4px -4px, -4px 0px;border:2px solid #555;cursor:pointer;margin:2px;" title="Transparent"></button>
<button class="palette-color-btn" data-color="0" style="width:32px;height:32px;background:#1A1A1A;border:2px solid #555;cursor:pointer;margin:2px;" title="Black"></button>
<button class="palette-color-btn" data-color="2" style="width:32px;height:32px;background:#F0E050;border:2px solid #555;cursor:pointer;margin:2px;" title="Yellow"></button>
<button class="palette-color-btn" data-color="3" style="width:32px;height:32px;background:#A02020;border:2px solid #555;cursor:pointer;margin:2px;" title="Red"></button>
<button class="palette-color-btn" data-color="5" style="width:32px;height:32px;background:#5080B8;border:2px solid #555;cursor:pointer;margin:2px;" title="Blue"></button>
<button class="palette-color-btn" data-color="6" style="width:32px;height:32px;background:#608050;border:2px solid #555;cursor:pointer;margin:2px;" title="Green"></button>
<button class="palette-color-btn active" data-color="1" style="width:32px;height:32px;background:#F2F1E6;border:2px solid #555;cursor:pointer;margin:2px;" title="White"></button>
</div>
<input type="hidden" id="fillColor" value="1">
</div>
<div id="outlineColorContainer" style="width:140px;display:none;position:relative;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Outline:</label>
<button type="button" id="outlineColorBtn" class="color-preview-btn" style="width:100%;height:38px;border:2px solid #555;cursor:pointer;background:#2a2a2a;display:flex;align-items:center;padding:4px 6px;" title="Click to select outline color">
<span id="outlineColorIndicator" style="display:inline-block;width:28px;height:28px;background:#1A1A1A;border:2px solid #333;margin:2px;flex-shrink:0;"></span>
<span id="outlineColorLabel" style="margin-left:6px;font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">Black</span>
</button>
<div id="outlineColorPalette" class="color-palette-popup" style="display:none;position:absolute;background:#2a2a2a;padding:8px;border:2px solid #555;border-radius:4px;z-index:1000;margin-top:4px;top:100%;">
<button class="palette-color-btn" data-color="transparent" style="width:32px;height:32px;background:linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);background-size:8px 8px;background-position:0 0, 0 4px, 4px -4px, -4px 0px;border:2px solid #555;cursor:pointer;margin:2px;" title="Transparent"></button>
<button class="palette-color-btn active" data-color="0" style="width:32px;height:32px;background:#1A1A1A;border:2px solid #555;cursor:pointer;margin:2px;" title="Black"></button>
<button class="palette-color-btn" data-color="2" style="width:32px;height:32px;background:#F0E050;border:2px solid #555;cursor:pointer;margin:2px;" title="Yellow"></button>
<button class="palette-color-btn" data-color="3" style="width:32px;height:32px;background:#A02020;border:2px solid #555;cursor:pointer;margin:2px;" title="Red"></button>
<button class="palette-color-btn" data-color="5" style="width:32px;height:32px;background:#5080B8;border:2px solid #555;cursor:pointer;margin:2px;" title="Blue"></button>
<button class="palette-color-btn" data-color="6" style="width:32px;height:32px;background:#608050;border:2px solid #555;cursor:pointer;margin:2px;" title="Green"></button>
<button class="palette-color-btn" data-color="1" style="width:32px;height:32px;background:#F2F1E6;border:2px solid #555;cursor:pointer;margin:2px;" title="White"></button>
</div>
<input type="hidden" id="outlineColor" value="0">
</div>
</div>
</div>
<div class="canvas-controls-row canvas-controls-secondary" style="display:flex;flex-wrap:wrap;align-items:flex-start;gap:12px;">
<div id="lineWidthContainer" style="width:160px;display:none;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Line Width:</label>
<div style="display:flex;align-items:center;gap:8px;">
<input type="range" id="lineWidth" min="1" max="50" value="2" style="flex:1;min-width:0;">
<span id="lineWidthDisplay" style="flex-shrink:0;min-width:50px;text-align:right;font-size:13px;">2px</span>
</div>
</div>
<div id="roundedRectRadiusContainer" style="width:160px;display:none;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Corner Radius:</label>
<div style="display:flex;align-items:center;gap:8px;">
<input type="range" id="roundedRectRadius" min="0" max="100" value="20" style="flex:1;min-width:0;">
<span id="roundedRectRadiusDisplay" style="flex-shrink:0;min-width:50px;text-align:right;font-size:13px;">20px</span>
</div>
</div>
<div id="textToolOptions" style="width:140px;display:none;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Font Size:</label>
<select id="textFontSize" style="width:100%;padding:6px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:13px;">
<option value="12">12px</option>
<option value="16">16px</option>
<option value="20">20px</option>
<option value="24">24px</option>
<option value="32">32px</option>
<option value="48">48px</option>
<option value="64">64px</option>
<option value="96" selected>96px</option>
<option value="128">128px</option>
<option value="160">160px</option>
<option value="200">200px</option>
<option value="256">256px</option>
<option value="320">320px</option>
<option value="400">400px</option>
<option value="512">512px</option>
</select>
</div>
<div id="textFontFamilyContainer" style="width:160px;display:none;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Font:</label>
<select id="textFontFamily" style="width:100%;padding:6px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:13px;">
<optgroup label="System Fonts">
<option value="Arial" selected>Arial</option>
<option value="Times New Roman">Times New Roman</option>
<option value="Courier New">Courier New</option>
<option value="Georgia">Georgia</option>
<option value="Verdana">Verdana</option>
</optgroup>
<optgroup label="Google Fonts">
<option value="Roboto">Roboto</option>
<option value="Open Sans">Open Sans</option>
<option value="Lato">Lato</option>
<option value="Montserrat">Montserrat</option>
<option value="Oswald">Oswald</option>
<option value="Raleway">Raleway</option>
<option value="Poppins">Poppins</option>
<option value="Ubuntu">Ubuntu</option>
<option value="Playfair Display">Playfair Display</option>
<option value="Merriweather">Merriweather</option>
<option value="Source Sans Pro">Source Sans Pro</option>
<option value="PT Sans">PT Sans</option>
<option value="Noto Sans">Noto Sans</option>
<option value="Lora">Lora</option>
<option value="Dancing Script">Dancing Script</option>
<option value="Bebas Neue">Bebas Neue</option>
<option value="Anton">Anton</option>
<option value="Fjalla One">Fjalla One</option>
<option value="Righteous">Righteous</option>
<option value="Lobster">Lobster</option>
</optgroup>
</select>
</div>
<div id="textAlignContainer" style="width:140px;display:none;flex-shrink:0;">
<label style="display:block;margin-bottom:6px;font-size:14px;color:#e0e0e0;">Alignment:</label>
<select id="textAlign" style="width:100%;padding:6px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:13px;">
<option value="left" selected>Left</option>
<option value="center">Center</option>
<option value="right">Right</option>
</select>
</div>
</div>
</div>
<div class="canvas-actions-wrapper" style="margin-bottom:10px;display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:8px;">
<div class="canvas-actions-primary" style="display:flex;flex-wrap:wrap;gap:8px;flex:1 1 auto;">
<button onclick="clearCanvas()">Clear Canvas</button>
<button onclick="undoCanvas()" id="undoBtn" disabled>Undo</button>
<button onclick="redoCanvas()" id="redoBtn" disabled>Redo</button>
<button onclick="loadImageToCanvas()" id="loadImageBtn">Load Image</button>
<button onclick="loadFramebufferToCanvas()" id="loadFrameBtn" disabled>Load Frame</button>
<input type="file" id="imageFileInput" accept="image/*" capture="environment" style="display:none;" onchange="handleImageFileSelect(event)">
</div>
<div class="canvas-actions-secondary" style="display:flex;gap:8px;align-items:center;flex-shrink:0;margin-left:auto;">
<input type="text" id="canvasFilenameInput" placeholder="canvas_2025-12-30T12-00-00.png" class="canvas-filename-input" style="width:220px;padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:14px;display:none;">
<select id="canvasActionSelect" class="canvas-action-select" style="padding:8px;border:1px solid #444;border-radius:4px;box-sizing:border-box;background:#1a1a1a;color:#e0e0e0;font-size:14px;min-width:180px;">
<option value="display" selected>Display on Panel</option>
<option value="display-save">Display on Panel & Save</option>
<option value="save">Save</option>
</select>
<button onclick="sendCanvasAction()" id="canvasActionBtn" disabled class="canvas-action-go" style="min-width:48px;padding:8px 12px;min-height:44px;">Go</button>
</div>
</div>
<div id="imageProcessingPanel" class="image-processing-panel" style="display:none;margin-bottom:15px;padding:15px;background:#2a2a2a;border-radius:8px;border:1px solid #444;">
<h3 style="color:#4CAF50;margin-top:0;margin-bottom:15px;font-size:16px;">Image Processing Options</h3>
<div class="flex-row image-processing-controls" style="align-items:flex-end;justify-content:space-between;">
<div class="flex-item image-processing-slider" style="min-width:150px;">
<label>Brightness:</label>
<input type="range" id="imageBrightness" min="-50" max="50" value="10" class="processing-slider" style="width:100%;">
<span id="imageBrightnessDisplay" class="processing-value">+10%</span>
</div>
<div class="flex-item image-processing-slider" style="min-width:150px;">
<label>Contrast:</label>
<input type="range" id="imageContrast" min="-50" max="50" value="20" class="processing-slider" style="width:100%;">
<span id="imageContrastDisplay" class="processing-value">+20%</span>
</div>
<div class="flex-item image-processing-slider" style="min-width:150px;">
<label>Saturation:</label>
<input type="range" id="imageSaturation" min="-50" max="50" value="20" class="processing-slider" style="width:100%;">
<span id="imageSaturationDisplay" class="processing-value">+20%</span>
</div>
<div class="flex-item image-processing-checkbox" style="min-width:150px;display:flex;flex-direction:column;align-items:flex-start;justify-content:center;gap:8px;">
<label class="checkbox-label" style="margin:0;display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px;user-select:none;">
<input type="checkbox" id="imagePosterize" checked class="processing-checkbox" style="width:20px;height:20px;margin:0;cursor:pointer;">
<span>Posterize</span>
</label>
<label class="checkbox-label" style="margin:0;display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px;user-select:none;">
<input type="checkbox" id="imageDither" checked class="processing-checkbox" style="width:20px;height:20px;margin:0;cursor:pointer;">
<span>Dither</span>
</label>
</div>
<div class="flex-item image-processing-actions" style="flex-shrink:0;flex-grow:0;display:flex;flex-direction:column;gap:8px;">
<button onclick="disableAllProcessing()" id="disableAllProcessingBtn" style="min-height:48px;background:#666;">Disable All</button>
<button onclick="applyImageProcessing()" id="applyProcessingBtn" style="min-height:48px;">Apply Processing</button>
</div>
</div>
</div>
<canvas id="drawCanvas" width="1600" height="1200" style="max-width:100%;height:auto;"></canvas>
<div id="canvasStatus"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Other Commands</h2>
<div class="section-content" id="section-commands">
<button onclick="sendCommand('clear')" id="clearBtn" disabled>Clear Display</button>
<button onclick="sendCommand('next')" id="nextBtn" disabled>Next Media Item</button>
<button onclick="triggerHappyWeather()" id="happyWeatherBtn" disabled style="background:#FF9800;">Happy Place Weather</button>
<button onclick="triggerShuffleOn()" id="shuffleOnBtn" disabled style="background:#2196F3;">Shuffle On</button>
<button onclick="triggerShuffleOff()" id="shuffleOffBtn" disabled style="background:#2196F3;">Shuffle Off</button>
<div id="commandStatus"></div>
</div>
</div>
<div class="section">
<h2 onclick="toggleSection(this)">Command Log</h2>
<div class="section-content" id="section-log">
<div id="commandLog" style="max-height:300px;overflow-y:auto;background:#1a1a1a;padding:10px;border:1px solid #444;border-radius:4px;font-family:monospace;font-size:12px;white-space:pre-wrap;word-wrap:break-word;color:#e0e0e0;"></div>
</div>
</div>
<script>
// All JavaScript code has been refactored into modules:
// - js/config.js: Configuration constants and state variables
// - js/encryption.js: Encryption/decryption and HMAC functions
// - js/password.js: Password management (load, save, clear)
// - js/paho-loader.js: Paho MQTT library loader
// - js/ui-utils.js: UI helper functions (status, busy state, logging, sections)
// - js/media.js: Media mappings and thumbnail display
// - js/mqtt.js: MQTT connection and message handling
// - js/commands.js: Command sending functions
// - js/canvas.js: Canvas drawing tools and history
// - js/main.js: Initialization code
</script>
</html>
